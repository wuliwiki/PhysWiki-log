% 拉格朗日方程
% 广义坐标|拉格朗日量|拉格朗日方程|循环坐标|广义动量|约束
% eq: 5,7,8,9,10,11,12

\pentry{牛顿第二定律\upref{New3}，自由度\upref{DoF}， 偏导数\upref{ParDer}} %未完成，必须保证能支持以下内容！

若系统的状态可以由几个独立的\textbf{广义坐标（generalized coordinates）} $q_i(t)$ $(i=1,2\dots)$ 和时间 $t$ 的函数描述，则广义坐标关于时间的函数可通过\textbf{拉格朗日方程（Lagrange equation）}\footnote{也叫\textbf{欧拉-拉格朗日方程（Euler-Lagrange Equation）}}解出\footnote{方程中对 $\dot q$ 求偏导可能会使初学者看起来有些奇怪不知道该怎么求， 这里明确一下该偏导在数学上是如何操作的： 可将\autoref{Lagrng_eq2} 中 $L$ 的所有 $\dot q_i$ 记为 $v_i$， 然后将 $q_i$ 和 $v_i$ 看作是完全没有关联的变量， 求偏导时对 $q_1,q_2\dots, v_1, v_2\dots,t$ 中的一个求， 而保持其他量不变}．
\begin{equation}\label{Lagrng_eq1}
\dv{t} \pdv{L}{\dot q_i} = \pdv{L}{q_i}
\quad (i=1,2\dots)
\end{equation}
其中 $L$ 是系统的\textbf{拉格朗日量（lagrangian）}，等于系统动能减势能（我们先假设势能不是 $\dot q_i$ 的函数）
\begin{equation}\label{Lagrng_eq2}
L(q_1,q_2\dots,\dot q_1,\dot q_2\dots,t) = T(q_1,q_2\dots,\dot q_1,\dot q_2\dots,t) - V(q_1,q_2\dots, t)
\end{equation}

% 未完成: 作用量留到以后说
% 拉格朗日方程的解可以使作用量取最小值
% \begin{equation}
% S(q) = \int_{t_1}^{t_2} {L(q,\dot q) \dd{t}} 
% \end{equation}

拉格朗日力学与牛顿力学完全等效，其优势在于，第一，只需写出拉格朗日量，就可由简单求导得到完整的动力学微分方程而无需进行受力分析．第二，方程的形式不随广义坐标的选取而改变．第三，无需解方程即可以得到一些守恒量．

我们以下先通过一些例子来学习如何使用拉格朗日方程， 而把方程的证明或推导留到 “达朗贝尔定理\upref{dAlbt}” 以及 “哈密顿原理\upref{HamPrn}” 中．

\begin{example}{单个质点}\label{Lagrng_ex1}
若把一个质点作为系统，其直角坐标 $x,y,z$ 就可以看做一组广义坐标，把它们看做时间的函数 $x(t), y(t), z(t)$，则三个函数完整地描述了每个时刻质点的位置．三个函数对时间的导数（即速度的三个分量）记为 $\dot x, \dot y, \dot z$， 则质点的动能为 $T=m(\dot x^2+\dot y^2+\dot z^2)/2$． 令质点的势能为 $V(x,y,z,t)$， 拉格朗日量为
\begin{equation}
L(x,y,z, \dot x, \dot y, \dot z, t) = T-V = \frac12 m(\dot x^2+\dot y^2+\dot z^2) - V(x,y,z,t)
\end{equation}
现在列出 $x$ 坐标的拉格朗日方程，把上式对 $\dot x$ 求偏导（$x, y,z, \dot y, \dot z, t$ 视为常数），再对时间求导得
\begin{equation}
\pdv{L}{\dot x} = m\dot x
\qquad
\dv{t} \pdv{L}{\dot x} = m\ddot x
\end{equation}
再把拉格朗日量对 $x$ 求偏导得
\begin{equation}
\pdv{L}{x} = -\pdv{V}{x}
\end{equation}
以上两式代入拉格朗日方程，使用 $x$ 方向分力与势能的关系 $F_x = -\pdv*{V}{x}$， 得到 $x$ 分量上的牛顿第二定律
\begin{equation}
m\ddot x = F_x
\end{equation}
$y$ 和 $z$ 坐标的拉格朗日方程也可以得到对应的牛顿第二定律．三个分量的牛顿第二定律结合初始时刻的位置和速度就可以解出函数 $x(t), y(t), z(t)$． 
\end{example}

\begin{example}{中心力场问题}
仍然以一个质点作为系统，假设质点在一个平面内运动，使用极坐标 $r, \theta$ 为广义坐标，假设势能只是 $r$ 的函数 $V(r)$， 极坐标系中质点的速度（\autoref{PolA_eq3}\upref{PolA}）为
\begin{equation}\label{Lagrng_eq7}
\bvec v = \dot r\uvec r + r\dot \theta \uvec \theta
\end{equation}
动能等于
\begin{equation}
T = \frac12 m\bvec v^2 = \frac12 m(\dot r^2 + r^2 \dot \theta^2)
\end{equation}
类似于\autoref{Lagrng_ex1}， 两个广义坐标对应的拉格朗日方程分别为
\begin{equation}\label{Lagrng_eq10}
m\ddot r = mr \dot \theta^2 - \pdv{V}{r}
\end{equation}
\begin{equation}\label{Lagrng_eq11}
\dv{t} (m r^2\dot \theta)  = 0
\end{equation}
这是一个常微分方程组，直接求解较为复杂．但注意第二条方程等号右边为零，可以先对两边不定积分得
\begin{equation}\label{Lagrng_eq12}
mr^2\dot\theta = L
\end{equation}
其中 $L$ 为任意常数．根据角动量的定义\upref{AngMom}，结合\autoref{Lagrng_eq7} 不难发现 $L$ 就是质点的角动量，所以\autoref{Lagrng_eq11} 就是角动量守恒．

守恒量通常可以简化问题，若已知初始条件 $r(0), \theta (0), \dot r(0), \dot\theta (0)$， 可先算出角动量 $L$，再把\autoref{Lagrng_eq12} 代入\autoref{Lagrng_eq10} 消去 $\dot\theta$ 得到关于 $r$ 的单变量微分方程，进而解出 $r(t), \theta (t)$．
\end{example}

在该例中出现了一个\textbf{守恒量（conserved quantity）} $\pdv*{L}{\dot\theta}$， 原因是 $\theta$ 对应的拉格朗日方程右边为零
\begin{equation}
\dv{t}\pdv{L}{\dot\theta} = \pdv{L}{\theta} = 0
\end{equation}
即拉格朗日量与 $\theta$ 无关（或者表述成 “不含$\theta$”）．

一般地， \textbf{若拉格朗日量与某个广义坐标 $q_i$ 无关，则该坐标对应的广义动量 $p_i$ 是一个守恒量}， 我们把这样的坐标叫做\textbf{循环坐标}． \textbf{广义动量}（也叫\textbf{共轭动量}）被定义为
\begin{equation}\label{Lagrng_eq13}
p_i = \pdv{L}{\dot q_i}
\end{equation}

\begin{example}{耦合弹簧振子}
如图，%未完成
三个弹性系数为 $k$ 的弹簧（忽略质量）将两个质量为 $m$ 的质点串联在两个固定点之间，令一个广义坐标为中间弹簧的伸长距离 $x$，另一个广义坐标为两质点的质心与其平衡位置的距离 $X$， 则两质点相对平衡位置的位移分别为
\begin{equation}
x_1=X-x/2 \qquad x_2 = X+x/2
\end{equation}
动能为
\begin{equation}
T=\frac12 m\dot x_1^2 + \frac12 m\dot x_2^2 = m \qty(\dot X^2 + \frac14 \dot x^2)
\end{equation}
势能为
\begin{equation}
V = \frac12 k x^2 + \frac12 kx_1^2 + \frac12 k x_2^2 = k\qty(X^2 + \frac34 x^2)
\end{equation}
可求得拉格朗日方程组为
\begin{equation}
m\ddot x =  - 3kx \qquad m\ddot X =  - kX
\end{equation}
可见该问题中使用这种广义坐标的好处就是两个微分方程都只含有一个变量，易于求解． 由“简谐振子\upref{SHO}” 中的结论可得 $x(t)$ 和 $X(t)$ 的通解为
\begin{equation}
x(t) = x_0 \cos(\sqrt{\frac{3k}{m}} t + \phi_x)
\qquad
X(t) = X_0 \cos(\sqrt{\frac{k}{m}} t + \phi_X)
\end{equation}
若用 $x_1, x_2$ 坐标结合受力分析列出微分方程，则会得到两条各含两个变量的微分方程．在振动系统中，这种能使方程分离变量的广义坐标叫做\textbf{简正坐标}．%未完成，用矩阵专门讨论如何获得简正坐标
\end{example}

以上几个例子中，每个质点的坐标都是独立的，在没有约束时，$D$ 维空间中的 $N$ 质点有 $D\times N$ 个独立的广义坐标． 在一些问题中，我们往往会遇到不同形式的\textbf{约束}，例如当两个质点之间由轻棍连接时，约束方程为 $(x_1-x_2)^2+(y_1-x_2)^2+(z_1-z_2)^2=L^2$ 这时两个质点的自由度\upref{DoF}就由 6 个变为 5 个．约束可以是时间的函数，例如细棍的长度可以是关于时间的函数 $L(t)$．这里我们只讨论\textbf{完整约束}，即可以表示成以下形式
\begin{equation}
f_i(q_1,q_2,\dots ,q_N,t) = 0 \qquad (i = 1,2,\dots,M)
\end{equation}
若给 $N$ 个自由度的系统施加 $M<N$ 个完整约束，系统的自由度就变为 $N-M$ 个自由度，并可以用 $N-M$ 个广义坐标描述．

\begin{example}{不含时约束}
两个质量为 $m$ 的质点分别被限制在 $x$ 轴和 $y$ 轴上移动， 且他们之间由长度为 $l$ 的轻杆相连． $x$ 轴的质点另与一平行于 $x$ 轴的弹簧相连， 平衡位置为 $x_0$， 恢复系数为 $k$， 求该系统的运动方程．% 图未完成

该系统只有一个自由度， 我们可以把 $x$ 轴质点的 $x$ 坐标作为广义坐标， 则由约束方程 $x^2 + y^2 = l^2$ 可得 $y$ 轴质点的速度为
\begin{equation}
\dot y = -\frac{x\dot x}{\sqrt{l^2 - x^2}}
\end{equation}
所以系统的拉格朗日量为
\begin{equation}
L = \frac12 m \dot x^2\qty(1 + \frac{x^2}{l^2 - x^2}) + \frac12 k (x-x_0)^2
\end{equation}
代入拉格朗日方程即可．
\end{example}

\begin{example}{含时约束}
一个无穷长的细杆被固定在原点的转轴上，并在水平面上以角速度 $\omega$ 转动．一个质点可以沿细杆无摩擦运动，求质点的运动方程．

首先给细杆定义一个正方向，并取质点的离原点的距离为 $r$． 质点速度（\autoref{PolA_eq3}\upref{PolA}）为 $\bvec v = \dot r \uvec r + r\omega \uvec\theta$， 势能为 0． 系统的拉格朗日量为
\begin{equation}
L = T - V = \frac12 m(\dot r^2 + r^2 \omega^2)
\end{equation}
代入拉格朗日方程，得到运动方程
\begin{equation}
\ddot r = \omega^2 r
\end{equation}
该函数的通解为% 链接未完成
\begin{equation}
r(t) = C_1 \E^{\omega t} + C_2 \E^{-\omega t}
\end{equation}
\end{example}

\begin{example}{综合例题（包括解方程）}
% 未完成： 验算 + Matlab 画图
一根无限长杆在竖直平面绕杆上某点以角速度 $\omega$ 匀速转动， 一质点可以延杆做无摩擦运动， 质点与转轴由弹簧相连， 弹性系数为 $k$， 原长为 $r_0$， 求质点的运动轨迹．

令质点离转轴的距离为 $r$ （正方向任意选取）， 拉格朗日量为
\begin{equation}
L = T - V = \frac12 m(\dot r^2 + r^2\omega^2) - mgr\sin(\omega t) - \frac12 k (r - r_0)^2
\end{equation}
令 $\omega_0^2 = k/m - \omega^2$， 由拉格朗日方程得质点的轨道方程
\begin{equation}
\ddot r + \omega_0^2 r = -g \sin(\omega t) + \frac{k r_0}{m}
\end{equation}
这是一个二阶常系数非齐次微分方程\upref{Ode2N}， 直接套公式即可\footnote{也可以用\href{https://www.wolframalpha.com}{Wolfram Alpha}， 例如输入 \lstinline|y'' + a^2*y = -g*sin(w*x) + b|}．

要得到齐次解， 我们会发现 $\omega_0^2$ 的正负号很重要， 先来讨论角速度 $\omega$ 较小的情况即 $\omega_0^2 > 0$， 齐次解为
\begin{equation}
r(t) = C_1 r_1(t) + C_2 r_2(t) = C_1 \cos(\omega_0 t) + C_2 \sin(\omega_0 t)
\end{equation}
要求非齐次解， 先求朗斯基行列式% 引用未完成
\begin{equation}
W(t) = \vmat{r_1 & r_2\\ r'_1 & r'_2} = \omega_0
\end{equation}

\begin{equation}
\ali{
\int \frac{r_1 f(t)}{W} \dd{t} = &\frac{g}{\omega_0(\omega^2 - \omega_0^2)} [\omega_0 \sin(\omega_0 t) \sin(\omega t) + \omega \cos(\omega_0 t) \cos(\omega t)]\\
 &+ \frac{k r_0}{m\omega_0^2} \sin{\omega_0 t}
}\end{equation}

\begin{equation}
\ali{
&\int \frac{r_2 f(t)}{W} \dd{t} = &&\frac{-g}{\omega_0(\omega^2 - \omega_0^2)} [\omega_0 \cos(\omega_0 t) \sin(\omega t) - \omega \sin(\omega_0 t) \cos(\omega t)]\\
& &&- \frac{k r_0}{m\omega_0^2} \cos{\omega_0 t}
}\end{equation}

通解为
\begin{equation}\ali{
r(t) &=  C_1 r_1 + C_2 r_2 - r_1 \int \frac{r_2 f(t)}{W} \dd{t} + r_2 \int \frac{r_1 f(t)}{W} \dd{t}\\
&= C_1 \cos(\omega_0 t) + C_2 \sin(\omega_0 t) + \frac{g}{\omega^2 - \omega_0^2} \sin(\omega t) + \frac{k r_0}{m \omega_0^2}
}\end{equation}
可见这种情况下， 质点的径向运动是两个角频率分别为 $\omega$ 和 $\omega_0$ 的简谐振动的叠加．

同理， 当角速度 $\omega$ 较小即 $\omega_0^2 > 0$ 时， 通解为
\begin{equation}
r(t) = C_1 \E^{\omega_0 t} + C_2 \E^{-\omega_0 t} + \frac{g}{\omega^2 - \omega_0^2} \sin(\omega t) + \frac{k r_0}{m \omega_0^2}
\end{equation}
这种情况下， 质点一边以角频率 $\omega$ 延径向做简谐振动， 一边以指数形式远离或接近原点（取决于初始条件）．
\end{example}

\subsection{非保守力的拉格朗日方程}
% 未完成
：使用最小作用量证明