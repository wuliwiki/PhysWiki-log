% 小时百科文章示例
% keys 小时百科|文章编辑|latex|宏包
% license CCBYSA3
% type Tutor

\begin{issues}
\issueOther{用 issues 环境列出文章存在的所有问题。}
\issueDraft       % 本文处于草稿阶段
\issueTODO        % 本文存在未完成的内容
\issueMissDepend  % 本文缺少预备知识，初学者可能会遇到困难
\issueAbstract    % 本文需要更多讲解，便于帮助理解
\issueNeedCite    % 本文需要更多参考文献
\issueAi          % 本文含人工智能辅助创作，已审核。
\issueAiRaw       % 本文含人工智能辅助创作，待审核。
\end{issues}

\pentry{二项式定理\nref{nod_BiNor}， LaTeX 结构简介\nref{nod_latxIn}，原子单位的第二个节点（自动跳到预备知识 2）\nref{nod_a8e9}， 原子单位的默认节点（依赖整篇文章，相当于依赖最后一个节点）\nref{nod_AU}，原子单位第一个节点（变灰是因为是多余的，多余是因为原子单位第二个节点默认依赖第一个节点）\nref{nod_48f1}}{nod_44a1}

本文需要与 LaTeX 源码对照阅读， 请使用\href{https://wuli.wiki/editor}{在线编辑器}打开 \verb`Sample.tex`。

\subsection{文章信息}\label{sub_Sample_1}
文件开头可以用注释声明一些文章信息，但这些信息只能用 “\textbf{修改文章信息}” 按钮修改
\begin{itemize}
\item \textbf{关键词}，格式为 \verb`keys 关键词1|关键词2|...`。
\item 本文使用的\textbf{协议}， 格式为 \verb|license 协议id|（协议类型详见 “\enref{小时百科创作协议}{licens}”)。 \verb|协议 id| 有： \verb|Usr|（用户版权，无偿创作）, \verb|Xiao|（小时科技版权，有偿创作），\verb|CCBY3|，\verb|CCBYSA3|，\verb|CCBY4|，\verb|CCBYSA4|，\verb|Copy|（转载，只读）, \verb|Adap|（转载，可修改）, \verb|GPL3|, \verb|MIT|，\verb|Pub|（公有领域）。
\item \textbf{文章类型}， 格式为 \verb|type 类型id|， 其中 \verb|类型id| 支持： \verb|Wiki|（类似于维基百科的条目，中立、全面、一般性的介绍）， \verb|Tutor|（类似于教材的一节）， \verb|Art|（学术论文或杂谈等）， \verb|Map|（导航文章，介绍百科中的一章、一部分等，具有大量链接到其中的文章）， \verb|Note|（类似于讲义、总结，把知识要点简要列出）。
\item \verb|% keys|， \verb|% license|， \verb|% type| 三行注释必须紧接标题的注释， 中间不能有空行， 顺序不限。
\end{itemize}

\subsection{存在的问题}
接下来可以用 \verb`issue` 环境列出当前所有存在的问题。 支持的所有类型已在上方列出。

\subsection{预备知识}
\begin{itemize}
\item 预备知识是构建\href{https://wuli.wiki/tree/}{知识树}的重要部分，我们非常重视预备知识，几乎任何百科文章都需要预备知识，相关概念详见\enref{关于小时百科（白皮书）}{about}。
\item 如果读者学习某节点前\textbf{必须}先弄懂一些\textbf{其他文章}中的节点，就在 \verb`\pentry{}{}` 的第一个花括号中把它们列出来，并使用 \verb`\nref{}` 引用它们的 ID。
\item 例如上文中的预备知识的 ID 是 \verb`nod_af87`，可以在别的文章的 \verb`\pentry{\nref{...}}{}` 中引用。
\item 菜单的\textbf{预备知识}按钮可以插入预备知识列表 \verb`\pentry{知识点1\nref{节点id1}，知识点2\nref{节点id2}}{节点id}`。 所有的 \verb`节点id` 都以 \verb`nod_` 开头。
\item 一个预备知识列表定义了\href{https://wuli.wiki/tree/}{知识树}中的一个节点（简单说就是知识点），它的范围是它到下该文章的下一个预备知识列表之间（如果没有下一个就到文末）的全部内容。 该节点的 ID 就是 \verb`节点id`。
\item 每篇文章无论是否存在预备知识列表，都会有一个\textbf{默认的节点} \verb`nod_文章id` 其中 \verb`文章id` 是该文章的文件名。
\item 文章的每个节点默认依赖该文章的上一个节点，默认节点依赖最后一个节点（如果有）。
\item \verb`\nref{}` 命令可以通过 “外部引用” 按钮中的 “节点” 按钮来插入。 在提示 “输入序号” 时，如果不输入，则引用一篇文章的默认节点（即依赖于整篇文章）。 注意该命令暂时只能在 \verb`\pentry` 内部使用。
\item 如果需要的预备知识暂时不存在，可以先列出标题但不添加 \verb`\nref{}`，并注释具体需要什么（在注释中使用 \verb`\addTODO{描述}`），也可以先通过 \verb`\cite{}` 引用参考文献。
\end{itemize}

\subsection{蓝色的子节标题}\label{sub_Sample_2}
可以通过内部或外部引用按钮引用， 如\autoref{sub_Sample_2}。 引用其他文章的子节如\autoref{sub_BiNor_5}，注意后面会自动添加一个图标表示是其他文章的链接。

任何 \verb`\autoref{标签}` （无论本文还是其他文章）都支持对应的 \verb`\aref{链接文字}{标签}`， 如\aref{这个子节}{sub_Sample_2}， 和\aref{那个子节}{sub_BiNor_5}。
\addTODO{计划：所有标签（\verb`\label{标签}`）的引用，无论标签类型是什么（文章，公式，图片等），应该都支持三个命令：
\begin{itemize}
\item \verb`\upref{标签}` 显示为书签图标\upref{test}
\item \verb`\aref{任意文字}{标签}` 给\aref{任意文字}{sub_Sample_2}加链接到\verb`标签`定义处。
\item \verb`\autoref{标签}` 自动生成文字加链接，如\autoref{eq_Sample_2}（本文）或\autoref{eq_AU_10}（其他文章）。
\end{itemize}

在 pdf 中，需要考虑打印会使链接失效，所以变为以下效果：
\begin{itemize}
\item \verb`\upref{标签}` 变为一个脚注如 “见 103 页《向量空间》定义 2。”
\item \verb`\aref{任意文字}{标签}` 相当于给\verb`任意文字` 加下划线然后使用 \verb`\upref{标签}`
\item \verb`\autoref{标签}` 显示效果如 \verb`式 1`（本文）或 \verb`式 1` $^{\color{green}\small[103]}$（其他文章）
\end{itemize}

其他命令合并到这三个之中：\verb`\enref` 并入 \verb`\aref`， \verb`\nref` 并入 \verb`\upref`。

一个细节问题：\verb`\autoref` 这个命令有点长而且经常使用，是否要改成 \verb`\tref`。同理 \verb`\upref` 也可以改成 \verb`\uref`}

\subsubsection{黑色的子子节标题}
目前子子节标题无法引用。

\subsection{正文}\label{sub_Sample_16}
正文必须使用中文的括号，逗号，引号，冒号，分号，问号，感叹号，以及空心句号\footnote{《GB\_T15834\_2011 中华人民共和国国家标准标点符号用法》标准中允许科技文献中使用实心句号， 但 GB\_T15834\_2011 版的新标准规定都用空心。}， 禁止使用英文标点。 但为了打字方便， 行间公式最后仍允许英文逗号和句号（例如 \verb|~,| 和 \verb|~.|）， 且逗号后面需要有足够的空白（\verb|\quad| 或者 \verb|\qquad|）， 例如
\begin{equation}\label{eq_Sample_2}
a + b = c~, \quad d + e = f~.
\end{equation}
正文中\textbf{空行代表分段}， 所以\textbf{不要为了代码好看在公式前后习惯性加上一个空行}。 另外行间公式同样属于句子的一部分，需要在中间和末尾加上适当的标点符号，否则会提示错误。 如果根据语法，的确不需要加标点，可以在 \verb|\end{equation}|（或者结束的 \verb`$$` 或 \verb`\]`）之前加一个 \verb|~| 防止报错。 禁止批量对所有公式加 \verb|~|。 公式中标点的用法参考本文。

像 “牛顿—莱布尼兹公式” 中的横线必须用中文单破折号。 所有的标点符号前面不能有空格， 后面尽量有空格。 正文粗体如\textbf{粗体}。 正文中禁止使用 \verb|\\| 换行， 以及 \verb|\noindent|， \verb|\phantom| 等命令强制修改格式。

如果把 \verb|\footnote| 加在一个名词或者短语后面，意思是对它们做注释。 如果放在一个句号后面，就是对整句话做注释。

正文的任何地方可以用 \verb|\addTODO{}| 命令插入未完成提示。
\addTODO{在这里提示未完成的内容，如果不希望公开，注释掉即可，但仍然需要 \verb`\addTODO` 命令}

\subsection{引用}
引用公式和图表都统一使用 \verb|\autoref{标签}| 命令， \verb|\autoref| 和 \verb|\label{标签}| 都无需手动插入， 可以用菜单栏中的 “内部引用” 和 “外部引用” 按钮（实心和空心的双引号图标）。 注意 \verb|\autoref{}| 前面不加空格后面要加空格（后面是标点符号除外）， 例如\autoref{eq_Sample_1}。 如果要引用其他文章中的公式，可以引用 “\enref{其他文章}{BiNor}” 的\autoref{eq_BiNor_1} 也可以用 “\autoref{eq_BiNor_1} ”， 为了区分内部和外部引用， \verb|\upref| 不能忽略。 在 pdf 上， \verb|\upref{}| 会显示为页码。

一个升级版的 \verb`\upref{文章id}` 命令是 \verb`\enref{文字}{文章id}`， 可以把 \verb`文字` 直接链接到文章。 例如\enref{一篇测试}{test}。 新内容建议使用后者。

行间公式的 label （标签）必须要按照 \verb|eq_公式id| 的格式， 只有需要引用的公式才加标签。 图、表的标签分别以 \verb|fig_| 和 \verb|tab_| 开头，例题用 \verb|ex_|， 习题用 \verb|exe_|，子节用 \verb`sub_`。凡是有 \verb|\caption| 命令的环境（图、表），\verb|\label| 需要紧接其后。 事实上标签不建议手动添加， 可以用菜单栏上的 “内部引用” 和 “外部引用” 按钮在引用时同时自动插入 \verb|\label| 和 \verb|\autoref|， 详见\enref{编辑器使用说明}{EditRM}。

\subsection{公式}
行内公式用 \verb|$...$| 或者 \verb|\(...\)|， 两边需要有空格， 例如 $a^2+b^2=c^2$， 后面有标点符号的除外。 行间公式如
\begin{equation}\label{eq_Sample_1}
(a+b)^n = \sum_{i=0}^n C_n^i a^i b^{n-i} \quad (\text{$n$ 为整数})~.
\end{equation}

百科中常用公式的示例（包括支持的宏包和自定义的命令）见\enref{小时百科常用 LaTeX 公式}{XStexE}。

LaTeX 中各种符号的命令见\href{https://tug.ctan.org/info/symbols/comprehensive/symbols-a4.pdf}{官方符号对照表（pdf）}。

行间公式如果确定以后都不需要被引用， 可以用无编号的公式环境 \verb|$$...$$| 或者 \verb|\[...\]|。

\subsection{图表}

位图必须使用 png 格式， 矢量图（推荐）必须以 pdf 和 svg 格式\footnote{pdf 格式用于 pdf 版的百科， svg 用于网页显示}放在 figures 文件夹中。 文件名是文章 label 加下划线以及图片序号， 如 \verb|da8815a7f79f2f52.pdf|。 即使只有一张图片也要加上 \verb|_1|。 生成 svg 时， 字体一律用 outline， 更多选项中保留 7 位小数， 如果矢量图中包含位图， 要把 Image Location 选成 embed。 pdf 图片用于 latex 的 figure 环境， svg 图片用于 html 网页。图片宽度一律用 cm 为单位。 注意当前图片最大尺寸只能是 14.25cm， 对应 33 个汉字。 这个比例在 pdf 和 html 中都必须保持一致， 否则图中的文字大小可能会不协调。 由于 pdf 每行字数只有 33 个， 所以 html 中的图片不可能把页面占满。
\begin{figure}[ht]
\centering
\includegraphics[width=14.25cm]{./figures/da8815a7f79f2f52.pdf}
\caption{一二三四五六七八九十一二三四五六七八九十一二三四五六七八九十一二三口口口} \label{fig_Sample_1}
\end{figure}
引用图片如\autoref{fig_Sample_1}。 在 \verb|figure| 环境中， 必须用 \verb|\caption{}| 指定标题， \verb|\label{}| 只能放在 caption 的后面，否则编号会出错。由于在 pdf 中图片是浮动的，避免使用“上图”，“下图”等词。

再来看一个表格，如\autoref{tab_Sample_1}。 注意 \verb|\label| 同样要放在 \verb|\caption| 后面。
\begin{table}[ht]
\centering
\caption{极限 $\E$ 数值验证}\label{tab_Sample_1}
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
$x$ & ${10^{ - 1}}$ & ${10^{ - 2}}$ & ${10^{ - 3}}$ & ${10^{ - 4}}$ & ${10^{ - 5}}$ & ${10^{ - 6}}$ \\
\hline
$(1 + x)^{1/x}$ & 2.59374 & 2.70481 & 2.71692 & 2.71815 & 2.71827 & 2.71828 \\
\hline
\end{tabular}
\end{table}

定义如\autoref{def_Sample_1}。
\begin{definition}{名称（可省略）}\label{def_Sample_1}
定义导数为
\begin{equation}
f'(x) = \lim_{h \to 0} \frac{f(x + h) - f(x)}{h}~.
\end{equation}
\end{definition}

引理如\autoref{lem_Sample_1}。
\begin{lemma}{名称（可省略）}\label{lem_Sample_1}
三角形内角和为 $\pi$
\end{lemma}

定理如\autoref{the_Sample_1}。
\begin{theorem}{名称（可省略）}\label{the_Sample_1}
内错角相等
\end{theorem}

推论如\autoref{cor_Sample_1}
\begin{corollary}{名称（可省略）}\label{cor_Sample_1}
1 + 2 = 3
\end{corollary}

例子如\autoref{ex_Sample_1}。 
\begin{example}{名称（可省略）}\label{ex_Sample_1}
在例子中，我们的字体可以自定义，包括公式的字号会保持与内容一致。
\begin{equation}
(a+b)^n = \sum_{i=0}^n C_n^i a^i b^{n-i} \quad (\text{$n$ 为整数})~.
\end{equation}
\end{example}

习题如\autoref{exe_Sample_1}。 
\begin{exercise}{名称（可省略）}\label{exe_Sample_1}
已知 $b$ 和 $c$， 求 $a^2 + b^2 = c^2$。
\end{exercise}

\subsection{代码}
在行内显示代码用 \verb|\verb| 命令。 注意这个命令比较特殊， 可以用任何两个相同的符号作为定界符（星号 \verb|*| 除外）， 如 \verb+\verb?some|code?+ 会显示为 \verb?some|code?。 注意定界符必须是代码中没有的字符。

自动高亮的代码块使用 \verb|lstlisting| 环境（禁止用 \verb|\lstinputlisting| 从文件输入）
\begin{lstlisting}[language=matlabC]
s = 'abc'; % 一些评论
A =
     1     1    -1     1     3
     2     2    -2     1     7
     1     1     0     2     3
     2     2    -1     5     4

% 测试自定义关键字（必须是高亮）
matlabCTestKeyWord;
\end{lstlisting}

如果 lstlisting 标明了文件名（下划线需要用 \verb|\_| 转义）， 代码文件夹中就会自动生成该文件。 较长的代码文件必须含文件名， 文件名需要反映代码的内容而不是与文章 label 同名。
\addTODO{未完成： 后台处理 lstlisting 的 caption 时不应该在 html 显示空格转义的反斜杠}
\addTODO{未完成： 后台是否还不支持 lstlisting 环境的 label 以及引用。}

\begin{lstlisting}[language=matlab, caption=sample\_code.m]
% 验证二项式定理(非整数幂)
u = -3.5;
x = 0.6; % |x|<1 使级数收敛
N = 100; % 求和项数
Coeff = 1; % x^ii 项前面的系数
result = 1; % 求和结果
for ii = 1:N
    Coeff = Coeff*(u-ii+1) / ii;
    result = result + Coeff * x^(ii);
end
disp('直接计算结果为');
format long; % 显示全部小数位
disp((1+x)^u);
disp('求和结果为');
disp(result);
format short; % 恢复默认显示

% 测试自定义关键字（必须是高亮）
matlabTestKeyWord;

% 测试函数颜色（必须是黑色）
tan; cot; asin; acos; atan; arg; real; imag; sum;
mean; diff; floor; ceil; mod; sinh; cosh; round;
tanh; zeros; ones; rand; randn; eye; magic;
\end{lstlisting}

C++ 代码例如
\begin{lstlisting}[language=cpp]
template <class T, class T1, class T2,
MY_IF(is_scalar<T>() && is_scalar<T1>() && is_scalar<T2>())>
void Plus(T &v, const T1 &v1, const T2 &v2)
{ v = v1 + v2; }
\end{lstlisting}

Python 代码例如
\begin{lstlisting}[language=python]
def func1():
	return 'hello'
\end{lstlisting}

Mathematica 代码如
\begin{lstlisting}[language=mma]
(* 定义库仑函数 *)
CoulombF[l_, η_, ρ_] := 2^l E^(-π η/2) \
    Abs[Gamma[l + 1 + I η]]/(2 l + 1)! ρ^(l + 1) E^(-I ρ) \
    Hypergeometric1F1[l + 1 - I η, 2 l + 2, 2 I ρ]
\end{lstlisting}

Julia 代码如
\begin{lstlisting}[language=julia]
2^l *exp(-π η/2) (2 l + 1)! ρ^(l + 1) E^(-I ρ)
\end{lstlisting}

Makefile 代码如
\begin{lstlisting}[language=Makefile]
goal:
    g++ -O3 main.cpp -o main.x
\end{lstlisting}

LaTeX 代码如
\begin{lstlisting}[language=latex]
\begin{equation}
a^2 + b^2 = c^2
\end{equation}
\end{lstlisting}

Bash 代码如
\begin{lstlisting}[language=bash]
echo good > 123.txt
\end{lstlisting}

JavaScript 代码如
\begin{lstlisting}[language=js]
var a = 3
\end{lstlisting}

其他不支持高亮的代码都可以暂时用 \verb|none| 语言， 并注释实际的语言
% 未完成： [language=abcde]
\begin{lstlisting}[language=none]
abcde = 2^l E^(-π η/2)
\end{lstlisting}

\subsection{Unicode 支持}
正文中的 unicode 支持如 mäthμ≥≤， 代码中的 unicode 支持如 \verb|mathμ≤|， \lstinline|mäthμ≥≤|， 以及
\begin{lstlisting}[language=none]
mäthμ≥≤
\end{lstlisting}

% 测试正文中的支持的所有 unicode 字符：% 在 unicodechars.sty 中实现
% \addoTODO{这个还是编程实现比较好}

\subsection{文献引用}
目前整个百科公用一个参考文献列表的文章。 文章中引用文献格式如 \cite{GriffE}， 引用缺失如 “地球是圆的\needCite”。 但是由于 PhysWikiScan 还未实现该命令， 目前还是应该使用脚注。
\addTODO{needCite 还不能正常在 html 中显示}

网址的超链接如\href{https://wuli.wiki}{小时百科}。 注意 \verb|\href| 命令中的网址如果存在百分号， 需要在前面加反斜杠， 否则会被当做注释。另一种方法是，将其解码（url 中的百分号后面两个一定是 hex，表示 utf-8 的一个字节）。 这里列举一个\href{https://www.webatic.com/url-convertor}{在线解码网站}。

\subsection{付费内容}
付费内容仅限百科， 测试见\enref{test.tex}{test}。 用 \verb|\pay| 和 \verb|\paid| 包围付费内容即可， 若首行需要分段则要在 \verb|\pay| 后面空一行。 编辑器预览显示会员版本， 发布到 \verb|online| 目录后显示非会员的版本。

