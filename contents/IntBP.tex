% 分部积分法
% keys 微积分|积分|分部积分
% license Xiao
% type Tutor

\pentry{牛顿—莱布尼兹公式\nref{nod_NLeib}}{nod_ef5e}

若积分中的被积函数可以表示为两个函数的乘积， 则我们可以使用分部积分公式， $f(x)$ 和 $g(x)$ 分别为 $F(x)$ 和 $G(x)$ 的导函数， 有
\begin{equation}\label{eq_IntBP_1}
\int F(x)g(x)\dd{x}  = F(x)G(x) - \int f(x)G(x)\dd{x}~.
\end{equation}
\begin{equation}
\int_a^b F(x)g(x) \dd{x}  = \eval{F(x)G(x)}_a^b - \int_a^b f(x)G(x) \dd{x}~.
\end{equation}
用 $f^{(n)}(x)$ 表示 $n$ 阶导数，  $f^{[n]}(x)$ 表示 $n$ 次不定积分\footnote{这是笔者自己发明的符号}， 连续使用 $n$ 次分部积分公式， 有
\begin{equation}
\begin{aligned}
\int f(x)g(x) \dd{x} &= f(x)g^{[1]}(x) - f^{(1)}(x)g^{[2]}(x) + \dots + (-1)^{n-1} f^{(n-1)}(x) g^{[n]}(x)\\
 &+ (-1)^n \int f^{(n)}(x) g^{[n]}(x) \dd{x}~.
\end{aligned}
\end{equation}

\subsection{推导}
令$f(x) = F'(x)$，  $g(x) = G'(x)$， 根据乘法的求导公式
% \addTODO{链接}
\begin{equation}
[F(x)G(x)]' = f(x)G(x) + F(x)g(x)~.
\end{equation}
即
\begin{equation}\label{eq_IntBP_2}
F(x)g(x) = [F(x)G(x)]' - f(x)G(x)~.
\end{equation}
两边不定积分（积分常数可任取）得
\begin{equation}\label{eq_IntBP_6}
\int F(x)g(x) \dd{x}  = F(x)G(x) - \int f(x)G(x) \dd{x}~.
\end{equation}
所以如果被积函数等于两个函数的乘积，则可选择其中一个（$F$ ）为“求导项”进行求导，另一个（ $g$）为“积分项”进行不定积分（积分常数可任取），然后代入该式即可。

若要计算定积分，既可以先计算不定积分然后使用牛顿—莱布尼兹公式，也可以直接对\autoref{eq_IntBP_2} 进行定积分得
\begin{equation}\label{eq_IntBP_4}
\int_a^b F(x)g(x) \dd{x}  = \qty[ F(x)G(x) ]_a^b - \int_a^b f(x)G(x) \dd{x}~.
\end{equation}

\begin{example}{求 $x \E^{ - x}$ 的不定积分和从 $0$ 到 $+\infty$ 的定积分}
令 $x$ 项为“求导项”，导数为1， $\E^{ - x}$ 为“积分项”，积分为 $-\E^{ - x}$。代入\autoref{eq_IntBP_6} 得
\begin{equation}
\int x \E^{ - x} \dd{x}  = x(-\E^{ - x}) - \int 1 \times (-\E^{ - x}) \dd{x}  =  - x \E^{ - x} - \E^{ - x} + C~.
\end{equation}
如果直接计算定积分，把“求导项”和“积分项”直接代入\autoref{eq_IntBP_4} 得
\begin{equation}
\int_0^{+\infty} x \E^{-x} \dd{x}  = \eval{ x( - \E^{-x}) }_0^{ + \infty } - \int_0^{+\infty} 1 \times (-\E^{-x}) \dd{x}  = 0 - \eval{ \E^{-x} }_0^{+\infty} = 1~.
\end{equation}
\end{example}

\subsection{多次分部积分}
由于 $f(x)$ 的 $n$ 次导数可以记为 $f^{(n)}(x)$，不妨把 $g(x)$ 的 $n$ 次不定积分（ $n$ 个积分常数任取）记为 $g^{[n]}(x)$。则分部积分\autoref{eq_IntBP_6} 可记为
\begin{equation}
\int f(x)g(x) \dd{x}  = f(x) g^{[1]}(x) - \int f^{(1)}(x) g^{[1]}(x) \dd{x}~.
\end{equation}
再对第二项利用分部积分，仍然将 $f^{(1)}$ 作为“求导项”， $g^{[1]}$ 作为“积分项”，得
\begin{equation}
\int f(x)g(x) \dd{x}  = f(x) g^{[1]}(x) - f^{(1)}(x) g^{[2]}(x) + \int f^{(2)}(x) g^{[2]}(x) \dd{x}~.
\end{equation}
再把 $f^{(2)}$ 作为“求导项”， $g^{[2]}$ 作为“积分项”，分布积分得
\begin{equation}
\begin{aligned}
\int f(x)g(x) \dd{x} &= f(x) g^{[1]}(x) - f^{(1)}(x) g^{[2]}(x) + f^{(2)}(x)g^{[3]}(x) \\
&- \int f^{(3)}(x) g^{[3]}(x) \dd{x}~.
\end{aligned}
\end{equation}
可以发现若要使用 $N$ 次分部积分，第 $i \leqslant N$ 项等于第 $i-1$ 项中的“求导项”求导，“积分项”积分，再取相反数，最后不定积分中只需把“求导项”额外求一次导即可。 

% 未完成：例二：用连续分布积分来做 例1
