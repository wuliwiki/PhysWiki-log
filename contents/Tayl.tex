% 泰勒公式
% 泰勒公式|泰勒展开|微分中值定理|洛必达法则

\begin{theorem}{泰勒公式}\label{Tayl_the1}
设函数 $f(x)$ 在 $x_0$ 处有 $n(n\ge 1)$ 阶导数，则有
\begin{equation}
\begin{aligned}
f(x)=&f(x_0)+\frac{f'(x_0)}{1!}(x-x_0)+\frac{f''(x_0)}{2!}(x-x_0)^2+\cdots\\
&+\frac{f^{(n)}(x_0)}{n!}(x-x_0)^n+o((x-x_0)^n)
\end{aligned}
\end{equation}
最后一项 $o((x-x_0)^n)$ 也被称为\textbf{皮亚诺余项}．如果取 $x_0=0$，那么这个展开式被称为\textbf{麦克劳林公式}．
\end{theorem}
\begin{theorem}{$n$ 阶近似公式的唯一性}\label{Tayl_the2}
设函数 $f(x)$ 在 $x_0$ 处有 $n(n\ge 1)$ 阶导数，设 $f(x)$ 在 $x_0$ 的邻域内有以下 $n$ 阶近似公式成立：
\begin{equation}
\begin{aligned}
f(x)=a_0+a_1(x-x_0)+a_2(x-x_0)^2+\cdots+a_n(x-x_0)^n+o((x-x_0)^n)
\end{aligned}
\end{equation}
那么系数 $a_i(0\le i\le n)$ \textbf{存在}且\textbf{唯一确定}：
\begin{equation}
a_i=\frac{f^{(i)}(x)}{i!}
\end{equation}
这表明了 $f(x)$ 的 $n$ 阶近似公式的唯一性．
\end{theorem}
利用这个结论，我们可以在计算泰勒展开公式时自信地代入近似公式，而不是循规蹈矩地一步步求导．以 $e^{\sin x}$ 为例，如果在 $x=0$ 附近求泰勒展开，我们可以先将指数 $\sin x$ 写成近似公式：
\begin{equation}
u=\sin x=x-\frac{x^3}{3!}+o(x^4)
\end{equation}
再将上式代入 $e^u=1+u+u^2/2+u^3/6+u^4/24+o(u^3)$ 中，即可得到
\begin{equation}
\begin{aligned}
e^{\sin x}&=1+(x-\frac{x^3}{3!})+(x^2/2-x^4/6)+x^3/6+x^4/24+o(x^3)
\\&=1+x+x^2/2-x^4/8+o(x^3)
\end{aligned}
\end{equation}
利用这个结论，我们可以轻松地写出 $\sin (2x),\cos(x^2),e^{3x^3}$ 或类似形式的函数的泰勒展开式．下面我们举一个复杂的例子：
\begin{exercise}{}
计算 $f(x)=x\cot x(x\neq 0),f(0)=0$ 在 $x_0=0$ 附近的泰勒展开公式（展开到 $x^5$ 项）．
\end{exercise}
提示：我们已经知道 $\sin x=x-x^3/3!+x^5/5!+o(x^6),\cos x=1-x^2/2+x^4/4!-x^6/6!o(x^6)$．要求 $x\cot x=x\cos x/\sin x$ （$0$ 是该函数的可去间断点）的 $5$ 阶近似公式，可以利用待定系数法．设 $x\cot x=a_0+a_1 x+a_2 x^2+\cdots+ a_5 x^5 + o(x^5)$．根据 \autoref{Tayl_the2}  ，系数 $a_0,a_1,\cdots$ 是唯一确定的，求得的这个近似公式就是 $x\cot x$ 的泰勒展开式．我们只需要求出这些系数．

由于 $x\cot x=x\cos x/\sin x=a_0+a_1 x+\cdots a_5 x^5+o(x^5)$，所以
\begin{equation}
\begin{aligned}
x\cos x&=(a_0+a_1 x+\cdots a_5 x^5+o(x^5))\sin x\\
x(1-x^2/2+x^4/4!-x^6/6!+o(x^6))&=(a_0+a_1 x+\cdots a_5 x^5+o(x^5))\\
&\cdot (x-x^3/3!+x^5/5!+o(x^6))
\end{aligned}
\end{equation}
接下来化简上述方程，逐项比较解得 $a_0,\cdots,a_5$ 即可．待定系数法可以帮助我们大大减小求导的运算量．\footnote{$\cot x$ 的洛朗展开式的各项系数可以用\textbf{伯努利数}表示．}

利用柯西微分中值定理，可以推出带\textbf{拉格朗日余项}的泰勒展开公式，从而给出了泰勒展开近似式误差项的一个定量描述：
\begin{theorem}{带拉格朗日余项的泰勒公式}
设函数 $f(x)\in C^n[a,b]$\footnote{$f\in C^n[a,b]$ 表示函数 $f(x)$ 在闭区间 $[a,b]$ 上有 $n$ 阶连续导数．} 在 $(a,b)$ 内存在 $n+1$ 阶导数，则对任意 $x,x_0\in [a,b]$，总是存在 $\xi\in (x,x_0)$，使得下式成立
\begin{equation}
\begin{aligned}
f(x)=&f(x_0)+\frac{f'(x_0)}{1!}(x-x_0)+\frac{f'(x_0)}{2!}(x-x_0)^2+\cdots\\
&+\frac{f^{(n)}(x)}{n!}(x-x_0)^n+\frac{f^{(n+1)}(\xi)}{(n+1)!}(x-x_0)^{(n+1)}
\end{aligned}
\end{equation}
其中 $\frac{f^{(n+1)}(\xi)}{(n+1)!}(x-x_0)^{n+1}$ 被称为\textbf{拉格朗日余项}．有时也将 $\xi$ 用 $x_0+\theta(x-x_0)$ 来表示．
\end{theorem}

由于拉格朗日余项有分母 $(n+1)!$，随着 $n$ 的增加快速增大，所以通常情况下，用泰勒公式逼近时误差随 $n$ 的增加而减小（我们需要考察 $f^{(n+1)}(\xi)$ 的大小来判断误差的收敛速度）．以 $e^x$ 的泰勒展开式为例：
\begin{equation}
e^x=1+x+\frac{x^2}{2}+\cdots+\frac{x^n}{n!}+\frac{e^{\theta x}}{(n+1)!}x^{n+1}
\end{equation}
从上式我们可以看出，$e^x$ 的泰勒展开式的拉格朗日余项的绝对值不会超过 $\frac{\max\{1,e^x\}}{(n+1)!}$．这说明随着 $n$ 的增大，泰勒公式的前 $n$ 项和逐渐逼近 $e^x$．这个结论用皮亚诺余项\autoref{Tayl_the1} 是无法得到的\footnote{皮亚诺余项 $o((x-x_0)^n)$ 意味着当 $x$ 趋向于 $x_0$ 时泰勒公式将是很好的近似，但当 $x$ 远离 $x_0$ 时，就难以判断了．}．

需要记忆的泰勒展开公式有：
\begin{equation}\label{Tayl_eq1}
\begin{aligned}
&e^x=1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+\cdots+\frac{x^n}{n!}+o(x^n)\\
&\frac{1}{1+x}=1-x+x^2-x^3+\cdots+(-1)^nx^n+o(x^n)\\
&\sin x=x-\frac{x^3}{3!}+\frac{x^5}{5!}-\frac{x^7}{7!}+\cdots+(-1)^n\frac{x^{2n+1}}{(2n+1)!}+o(x^{2n+1})\\
&\cos x=1-\frac{x^2}{2!}+\frac{x^4}{4!}-\frac{x^6}{6!}+\cdots+(-1)^n\frac{x^{2n}}{(2n)!}+o(x^{2n})\\
&\ln (1+x)=x-\frac{x^2}{2}+\frac{x^3}{3}-\frac{x^4}{4}+\cdots+(-1)^{n+1}\frac{x^n}{n}+o(x^n)\\
\end{aligned}
\end{equation}
现在，如果我们将 $e^{ix}$ 用第一个公式展开，可以得到
\begin{equation}
\begin{aligned}
e^{ix}=1+ix-\frac{x^2}{2!}-i\frac{x^3}{3!}+\frac{x^4}{4!}+i\frac{x^5}{5!}-\frac{x^6}{6!}-i\frac{x^7}{7!}+\cdots\\
=(1-\frac{x^2}{2!}+\frac{x^4}{4!}-\frac{x^6}{6!}+\cdots)+i(x-\frac{x^3}{3!}+\frac{x^5}{5!}-\frac{x^7}{7!}+\cdots)
\end{aligned}
\end{equation}
再由欧拉公式 $e^{ix}=\cos x+i\sin x$，比较实部和虚部，恰好可以得出 $\cos x,\sin x$ 的展开式，与\autoref{Tayl_eq1} 完全相同．注意这里的推导还没有被严格化，将 $e^{ix}$ 已经超出实函数的范围，相关的定义和定理需要进行考量\footnote{在\textbf{数学物理方法}或\textbf{复变函数}课中你将会系统地学习这些内容．}．
对 $\ln(1+x)$ 泰勒展开也有一个不严谨的小技巧．注意到它的导函数为 $\frac{1}{1+x}$，可以尝试对 $\frac{1}{1+x}$ 的泰勒展开式进行积分．
\begin{equation}
\begin{aligned}
\frac{1}{1+x}&=\sum_{i=0}^{\infty} (-1)^i x^i\\
\ln(1+x)&=\int_0^x \frac{1}{1+t}\dd t = \int_0^x \sum_{i=0}^{\infty} (-1)^i x^i\dd t \\
&= \sum_{i=0}^{\infty} \int_0^x(-1)^i x^i\dd t = \sum_{i=0}^{\infty} \frac{(-1)^i x^{i+1}}{i+1}\\
&= \sum_{i=1}^{\infty} \frac{(-1)^{i+1} x^{i}}{i}
\end{aligned}
\end{equation}
这种推导方法可以帮助你记忆公式．如果想让这个证明严谨化，就需要利用级数相关定理，要注意级数的收敛域，还需要判断上式中 $\int_0^{\infty}$ 和 $\sum_{i=0}^{\infty}$ （这实际上是序列极限 $\lim\limits_{n\rightarrow \infty} \sum_{i=0}^{n}$ 的一种简写）在什么情况下可交换．
下面我们用这种方法再算一个例子．
\begin{exercise}{}
计算 $\frac{x}{\sqrt{1+x^2}}$ 在 $x_0=0$ 处的泰勒展开，展开到 $x^7$ 项．
\end{exercise}
提示：$\frac{x}{\sqrt{1+x^2}}$ 可以写作 $\sqrt{1+x^2}$ 的导函数．那么只需要对 $\sqrt{1+x^2}$ 的泰勒展开式逐项求导即可．注意到 $\sqrt{1+x}=1+\frac{x}{2}-\frac{x^2}{8}+\frac{x^3}{16}-\frac{5x^4}{128}+o(x^4)$，于是有
\begin{equation}
\begin{aligned}
\sqrt{1+x^2}=1+\frac{x^2}{2}-\frac{x^4}{8}+\frac{x^6}{16}-\frac{5x^8}{128}+o(x^8)\\
\frac{x}{\sqrt{1+x^2}}=x-\frac{x^3}{2}+\frac{3x^5}{8}-\frac{5x^7}{16}+o(x^7)
\end{aligned}
\end{equation}

上面我们用到了 $\sqrt{1+x}$ 的泰勒展开公式，它可以通过暴力求导计算得到：
\begin{equation}
\begin{aligned}
\sqrt{1+x}&=1+\sum_{i=1}^n\frac{(-1)^{i+1} \cdot \frac{1}{2}\cdot \frac{3}{2}\cdots (i-\frac{3}{2})}{2i!}x^i +o(x^n)\\
&=1+\sum_{i=1}^n\frac{\Gamma(3/2)}{\Gamma(i+1)\Gamma(-i+3/2)}x^i +o(x^n)
\end{aligned}
\end{equation}
上式中 $\Gamma$ 为广义阶乘函数，当 $n$ 为整数时 $\Gamma(n+1)=n!$．更具有启发意义地，我们可以将上面的结果写成以下形式
\begin{equation}
(1+x)^{1/2}=\sum_{i=0}^{\infty}{1/2\choose i}x^i
\end{equation}
其中 ${1/2\choose i}$ 为广义组合数．这个公式可以推广为以下结果：
\begin{equation}
(1+x)^{a}=\sum_{i=0}^{\infty}{a\choose i}x^i=\sum_{i=0}^{\infty}\frac{\Gamma(a+1)}{\Gamma(i+1)\Gamma(-i+a+1)}x^i
\end{equation}