% 拉格朗日方程（额外广义力）

\pentry{欧拉—拉格朗日方程\upref{Lagrng}}

在之前的讨论中， 所有的系统外力都可以纳入势能项 $V$ 中． 这些里一般来说是保守力， 然而许多情况中还可能出现种种非保守力， 例如摩擦力等， 较难用势能描述． 这时引入\textbf{广义力（generalized force）}的概念会更方便． 若系统的广义坐标为 $q_i$， 则每个广义坐标对应的广义力定义为（上标 $e$ 表示 extra）
\begin{equation}\label{LagEqQ_eq3}
Q_i(q, \dot q, t) = \sum_j \bvec F_j \vdot \pdv{\bvec r_j}{q_i} \qquad (i=1,\dots,N)
\end{equation}
其中 $\bvec F_j$ 是除约束力的系统外力， 作用点为 $\bvec r_j$． 从虚功\upref{VirWrk}的角度， 广义力等于虚功对广义坐标的导数． 和之前一样， 为了书写方便式中 $q$ 代表 $q_1, \dots, q_N$， $\dot q$ 也同理．
\addTODO{虚功和虚功原理在哪里介绍？}

若非约束力 $\bvec F_j^{(e)}$ 不包含于势能项 $V$， 那么拉格朗日方程（\autoref{Lagrng_eq1}~\upref{Lagrng}）可以拓展为
\begin{equation}\label{LagEqQ_eq1}
\dv{t} \pdv{L}{\dot q_i} = \pdv{L}{q_i} + Q_i^{(e)}
\qquad (i=1,\dots,N)
\end{equation}
其中 $Q_i^{(e)}$ 的定义是把\autoref{LagEqQ_eq3} 中的 $\bvec F_j$ 替换为 $\bvec F_j^{(e)}$． 证明见 “拉格朗日方程的证明、达朗贝尔定理\upref{dAlbt}”．

若非约束力 $\bvec F_j^{(V)}$ 已经含于势能项 $V$， 那么可以证明\upref{dAlbt} $\pdv*{L}{q_i} = \pdv*{T}{q_i} + \pdv*{V}{q_i}$ 的最后一项同样也是广义力
\begin{equation}
Q_i^{(V)} = \pdv{V}{q_i} = \sum_j \bvec F_j^{(V)} \vdot \pdv{\bvec r_j}{q_i}
\end{equation}
那么如果令总广义力为
\begin{equation}
Q_i = Q_i^{(V)} + Q_i^{(e)}
\end{equation}
那么拉格朗日方程\autoref{LagEqQ_eq1} 也可以完全抛开势能项记为
\begin{equation}\label{LagEqQ_eq2}
\dv{t} \pdv{L}{\dot q_i} = \pdv{T}{q_i} + Q_i
\qquad (i=1,\dots,N)
\end{equation}

\begin{example}{受阻耦合弹簧振子}
\autoref{Lagrng_ex2}~\upref{Lagrng} 中， 若两个滑块受到于速度相反， 大小与速度平方成正比的摩擦力， 比例系数为 $\alpha$， 求运动方程．

注意摩擦力是取决于运动方向的． 令 $\dot x_i \geqslant 0$ 时 $s_i = 1$，$\dot x_i < 0$ 时 $s_i = -1$， 那么使用\autoref{LagEqQ_eq3}， 广义力为
\begin{equation}
\begin{aligned}
Q_x &= F_1 \pdv{x_1}{x} + F_2 \pdv{x_2}{x} = (-\alpha s_1\dot x_1^2) \cdot \frac{1}{2} + (-\alpha s_2\dot x_2^2) \cdot \frac{-1}{2}\\
&= \frac{\alpha}{2}(s_1\dot x_1^2 - s_2 \dot x_2^2)
\end{aligned}
\end{equation}
同理得
\begin{equation}
Q_X = -\alpha(s_1 \dot x_1^2 + s_2\dot x_2^2)
\end{equation}
现在 $s_1,s_2,\dot x_1,\dot x_2$ 可以进一步写成 $\dot x, \dot X$ 的函数， 具体略． 求得含摩擦力的运动方程为
\begin{equation}
m\ddot x =  - 3kx + 2Q_x~, \qquad
m\ddot X =  - kX + \frac{Q_X}{2}
\end{equation}
\end{example}
