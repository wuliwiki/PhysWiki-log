% 梯度、梯度定理
% keys 多元微积分|矢量|导数|方向导数|梯度|梯度算符|势函数|矢量函数|等值线|正交曲线坐标系|极坐标系|柱坐标系|球坐标系|线积分|牛顿-莱布尼兹公式|梯度定理
% license Xiao
% type Tutor

% \addTODO{docx 中有例题}
\pentry{方向导数\nref{nod_DerDir}}{nod_5b10}

在\enref{方向导数}{DerDir}中，我们推出方向导数为
\begin{equation}\label{eq_Grad_1}
\pdv{f}{n} = \grad f \vdot \uvec n~.
\end{equation}

其中 $\grad f$ 就叫标量函数 $f$ 的\textbf{梯度}\footnote{这里假设 $f$ 在某区域内处处光滑，即所有一阶偏导数处处连续。 这个性质也叫\textbf{可微}。}。 要注意当且仅当 Del 算符 $\grad$ 作用在标量函数（即函数值是一个数而不是矢量）上时， 可以称其为\textbf{梯度算符}。 这里的 $f$ 叫做\textbf{势函数}。对于 $N$ 维直角坐标系中的 $N$ 元函数 $f(x_1,x_2\dots x_N)$， 其梯度是一个\textbf{矢量}函数
\begin{equation}
\grad f = \sum_{i=1}^{N}\pdv{f}{x_i}\uvec x_i~.
\end{equation}
其中所有的 $\uvec x_i$ 组成直角坐标系的\enref{正交归一基}{OrNrB}，现在来看\enref{全微分}{TDiff}关系
\begin{equation}\label{eq_Grad_3}
\dd{f} = \sum_{i = 1}^N \pdv{f}{x_i} \dd{x_i}~.
\end{equation}
在直角坐标系中， 位置矢量 $\bvec r$ 的微分为
\begin{equation}
\dd{\bvec r} = \sum_{i=1}^{N} \dd{x_i} \uvec x_i~.
\end{equation}
\autoref{eq_Grad_3} 可用势函数的梯度和 $\dd{\bvec r}$ 的内积表示
\begin{equation}\label{eq_Grad_5}
\dd{f} = \grad f \vdot \dd{\bvec r}~.
\end{equation}
由\enref{内积}{Dot}的几何定义可知，从某点出发，若微位移 $\dd{\bvec r}$ 的大小不变，那么当其方向与梯度方向相同时函数增量 $\dd{f}$ 最大；二者方向垂直时，函数增量为零；二者夹角为 $\theta$ 时，函数增量等于最大值乘以 $\cos \theta$。 所以梯度矢量的方向是函数 $f$ 增加最快的方向， 梯度的大小等于该方向的方向导数。注意\autoref{eq_Grad_5} 和\autoref{eq_Grad_1} 的关系可以类比\enref{一元函数的导数}{Der}和\enref{微分}{Diff}的关系， 当函数可微时， 二者等效。 所以也可以把\autoref{eq_Grad_5} 看成梯度的定义（需要对所有方向的 $\dd{\bvec r}$ 都成立）。

现在我们也可以把全微分近似（“ 全微分\upref{TDiff}” \autoref{eq_TDiff_6}） 记为矢量的形式
\begin{equation}\label{eq_Grad_6}
\Delta f \approx \grad f \vdot \Delta \bvec r~.
\end{equation}

\subsection{极坐标，柱坐标和球坐标中的梯度算符}\label{sub_Grad_1}
\pentry{正交曲线坐标系\nref{nod_CurCor}}{nod_797c}

我们先写出极坐标中函数 $f(r,\theta)$ 的全微分为
\begin{equation}\label{eq_Grad_8}
\dd{f} = \pdv{f}{r} \dd{r} + \pdv{f}{\theta} \dd{\theta}~,
\end{equation}
再写出极坐标中的微位移为
\begin{equation}\label{eq_Grad_9}
\dd{\bvec r} = \dd{r} \uvec r + r \dd{\theta} \uvec \theta~.
\end{equation}
所以为了满足梯度的定义\autoref{eq_Grad_5}， 我们可以把\autoref{eq_Grad_8} 写为
\begin{equation}\label{eq_Grad_10}
\dd{f} = \pdv{f}{r} \dd{r} + \frac1r \pdv{f}{\theta} \cdot r\dd{\theta}~.
\end{equation}
对比\autoref{eq_Grad_5}， \autoref{eq_Grad_9} 和\autoref{eq_Grad_10} 可以得出\textbf{极坐标中的梯度算符}为
\begin{equation}
\grad = \uvec r \pdv{r} + \uvec \theta \frac1r \pdv{\theta}~.
\end{equation}

同理， 柱坐标中的微位移（\autoref{eq_CylNab_7}~\upref{CylNab}） 与函数 $f(r,\theta, z)$ 的全微分可以分别表示为
\begin{equation}
\dd{\bvec r} = \dd{r} \uvec r + r\dd{\theta} \uvec \theta + \dd{z} \uvec z~,
\end{equation}
\begin{equation}
\dd{f} = \pdv{f}{r} \dd{r} + \frac1r \pdv{f}{\theta} \cdot  r\dd{\theta} + \pdv{f}{z} \dd{z}~,
\end{equation}
所以\textbf{柱坐标中的梯度算符}为
\begin{equation}
\grad = \uvec r \pdv{r} + \uvec \theta \frac1r \pdv{\theta} + \uvec z \pdv{z}~.
\end{equation}

球坐标也类似， 球坐标中的微位移（\autoref{eq_SphNab_12}~\upref{SphNab}） 与 $f(r,\theta,\phi)$ 的全微分可以分别表示为
\begin{equation}
\dd{\bvec r} = \dd{r}\uvec r + r\dd{\theta} \uvec \theta + r\sin\theta\dd{\phi}\uvec \phi~,
\end{equation}
\begin{equation}
\dd{f} = \pdv{f}{r} \dd{r} + \frac1r \pdv{f}{\theta} \cdot r\dd{\theta} + \frac{1}{ r\sin\theta} \pdv{f}{\phi} \cdot r\sin\theta\dd{\phi}~.
\end{equation}
所以\textbf{球坐标中的梯度算符}为
\begin{equation}
\grad = \uvec r \pdv{r} + \uvec \theta \frac1r \pdv{\theta} + \uvec \phi \frac{1}{ r\sin\theta} \pdv{\phi}~.
\end{equation}

\subsection{梯度定理}
\pentry{线积分\nref{nod_IntL}， 牛顿—莱布尼兹公式\nref{nod_NLeib}}{nod_1e95}

\textbf{梯度定理} ：一个标量函数 $f(\bvec r)$ 的梯度延任何路径从起点 $\bvec r_i$ 到终点 $\bvec r_f$（角标 $i$ 表示 initial， $f$ 表示 final）  线积分的结果等于该函数在末位置的函数值减去初位置的函数值。可以用下式表示
\begin{equation}\label{eq_Grad_15}
\int_{\bvec r_i}^{\bvec r_f} \grad f(\bvec r) \vdot \dd{\bvec r} = f(\bvec r_f) - f(\bvec r_i)~.
\end{equation}
梯度定理可以看做是\enref{牛顿—莱布尼兹公式}{NLeib}
\begin{equation}\label{eq_Grad_16}
\int_a^b f'(x) \dd{x}  = f(b) - f(a)~
\end{equation}
的拓展， 即把一元函数拓展为多元函数，把导函数拓展为梯度函数（在一维情况下，\autoref{eq_Grad_15} 变为\autoref{eq_Grad_16}）。所以前者的证明也可以类比后者的证明。

\subsubsection{梯度定理的证明}

我们先把\autoref{eq_Grad_15} 路径分为许多首尾相接的小段曲线， 则整段曲线的线积分等于所有小曲线的线积分之和。假设曲线处处光滑， 如果每段小曲线都足够短，就可以把它们近似看做线段，且梯度值在上面近似为常矢量。令第 $i$ 小段的起点和终点分别为 $\bvec r_{i0}, \bvec r_{i1}$， 则第 $i$ 段的线积分可近似为
\begin{equation}
\int_{\bvec r_{i0}}^{\bvec r_{i1}} \grad f(\bvec r) \vdot \dd{\bvec r} \approx  \grad f(\bvec r_i) \vdot \Delta \bvec r_i~.
\end{equation}
再利用全微分近似（ \autoref{eq_Grad_6}），上式等于
\begin{equation}
\int_{\bvec r_{i0}}^{\bvec r_{i1}} \grad f(\bvec r) \vdot \dd{\bvec r} \approx f(\bvec r_{i1}) - f(\bvec r_{i0})~.
\end{equation}
将所有小段的线积分求和得到总的线积分得（ 注意 $\bvec r_{i1} = \bvec r_{(i+1)0}$） 
\begin{equation}\ali{
\int_{C} \grad f(\bvec r) \vdot \dd{\bvec r}
&= \sum_{i=1}^n \int_{\bvec r_{i0}}^{\bvec r_{i1}} \grad f(\bvec r) \vdot \dd{\bvec r}\\
&\approx  \sum_{i=1}^n [f(\bvec r_{i1}) - f(\bvec r_{i0})] 
= f(\bvec r_f) - f(\bvec r_i)~,
}\end{equation}
最后取极限 $n\to \infty$， 可使上式精确成立。证毕。

\subsection{梯度的逆运算}
\addTODO{并不是所有矢量场都存在梯度的逆运算， 链接}
\addTODO{这部分内容可以新建文章， 使用定理表述， 类似于\enref{散度的逆运算}{DivInv}。证明 $\bvec A$ 是无旋场当且仅当它可以表示为 $\grad V$， $V(\bvec r)$ 可以加上任意常数 $C$。}

我们通常把上面的标量函数 $f(\bvec r)$ 叫做\textbf{势函数}， 其地位相当于牛顿—莱布尼兹公式中的原函数。 在这个类比中， 既然“对原函数求导” 对应“对势函数求梯度”， 那么不定积分对应的“通过梯度函数求势函数”又该如何实现呢？

以二维的情况为例， 我们可以先指定势函数在某点 $\bvec r_0 (x_0,y_0)$ 的值， 然后根据\autoref{eq_Grad_15}， 要求势函数任意一点 $\bvec r (x,y)$ 的值， 只需从 $\bvec r_0$ 点出发由任意路径线积分到点 $\bvec r$ 即可得到势函数 $f(\bvec r)$。
\begin{equation}\label{eq_Grad_13}
f(\bvec r) =  f(\bvec r_0) + \int_{\bvec r_0}^{\bvec r} \grad f(\bvec r) \vdot \dd{\bvec r} ~.
\end{equation}
计算该线积分一般选取一种简单的路径：即先延从 $\bvec r_0(x_0,y_0)$ 到 $\bvec r_1(x, y_0)$ 的水平线段， 再延从 $\bvec r_1(x, y_0)$ 到 $\bvec r(x,y)$ 的竖直线段（当然也可以取中间点为 $(x_0,y)$）。 若把 $\grad f$ 的两个分量 $\pdv*{f}{x}, \pdv*{f}{y}$ 简写为 $f_x(x,y), f_y(x,y)$， 分关于 $x$ 和 $y$ 的不定积分记为 $F_x(x,y), F_y(x,y)$， 延两个线段的\enref{线积分}{IntL}（分别把 $x$ 和 $y$ 作为线积分的参数）分别为
\begin{equation}
 \int_{\bvec r_0}^{\bvec r_1} \grad f(\bvec r) \vdot \dd{\bvec r} = \int_{x_0}^{x} f_x(x,y_0) \dd{x} + 0 = F_x(x,y_0) - F_x(x_0,y_0)~,
\end{equation}
\begin{equation}
 \int_{\bvec r_1}^{\bvec r} \grad f(\bvec r) \vdot \dd{\bvec r} = \int_{y_0}^{y} f_y(x,y) \dd{y} + 0 = F_y(x,y) - F_y(x,y_0)~.
\end{equation}
代回\autoref{eq_Grad_13} 得势函数为
\begin{equation}\label{eq_Grad_23}\ali{
f(x,y) &= f(x_0,y_0) + F_x(x,y_0) - F_x(x_0,y_0) + F_y(x,y) - F_y(x,y_0) \\
&= F_y(x,y) - F_y(x,y_0) + F_x(x,y_0) + C~.
}\end{equation}
其中 $C$ 为待定常数。
