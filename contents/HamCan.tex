% 哈密顿正则方程
% keys 哈密顿量|拉格朗日变换|哈密顿正则方程|广义动量|共轭动量
% license Xiao
% type Tutor

\pentry{拉格朗日方程（额外广义力）\nref{nod_LagEqQ}， 勒让德变换\nref{nod_TrLgdr}}{nod_ec48}

\subsection{哈密顿量}
拉格朗日力学中使用 $N$ 个广义坐标 $q_1,\dots,q_N$ 和 $N$ 个广义速度 $\dot q_1,\dots,\dot q_N$ 来描述力学系统的状态， 我们分别简记为 $q$ 和 $\dot q$。 而在哈密顿力学中， 系统的状态由广义坐标和对应的 $N$ \textbf{广义动量（generalized momentum）} $p_1, \dots, p_N$， 来描述， 简记为 $p$。 我们定义广义动量为（\autoref{eq_Lagrng_13}）
\begin{equation}\label{eq_HamCan_4}
p_i = \pdv{L}{\dot q_i} \qquad (i = 1,\dots,N)~,
\end{equation}
$p$ 也可以叫做\textbf{正则动量（canonical momentum）}或者\textbf{共轭动量（conjugate momentum）}。

定义系统的\textbf{哈密顿量（Hamiltonian）}为
\begin{equation}\label{eq_HamCan_1}
H(q,p,t) = \sum_i \dot q_i p_i - L~,
\end{equation}
其中 $L$ 为拉格朗日量（\autoref{eq_Lagrng_1}）。 我们在能量积分（\autoref{eq_motint_2}）中见到过， 但在哈密顿力学中， 我们必须要把等式右边的每个 $\dot q_i$ 表示为 $(q,p,t)$ 的函数。 这可以通过解方程组\autoref{eq_HamCan_4} 求得。

从拉格朗日函数 $L$ 变为哈密顿量 $H$ 的这种变换， 叫做\enref{勒让德变换（Legendre transformation）}{TrLgdr}。

\subsection{哈密顿量与能量}
当拉格朗日量 $L$ 等于系统动能减势能时， 哈密顿量等于系统能量。 所以当我们在构建一个系统的拉格朗日量时， 往往不需要做勒让德变换， 而是直接用广义坐标和广义动量写出系统能量。 另外， 

\subsubsection{证明}
将系统看做质点系， 由于 $L = T - V$ 且 $V$ 与 $\dot q$ 无关， 有
\begin{equation}\label{eq_HamCan_6}
p_i = \pdv{L}{\dot q_i} = \pdv{\dot q_i} \sum_j \frac12 m_j \dot{\bvec r}_j^2
= \sum_j m_j \dot{\bvec r}_j \pdv{\dot{\bvec r}_j}{\dot q_i}
= \sum_j m_j \dot{\bvec r}_j  \pdv{\bvec r_j}{q_i}~,
\end{equation}
其中最后一步利用了\autoref{eq_dAlbt_27}。 所以
\begin{equation}
 \sum_i \dot q_i p_i = \sum_j m_j \dot{\bvec r}_j \sum_i \pdv{\bvec r_j}{q_i}\dv{q_i}{t}
= \sum_j m_j \dot{\bvec r}_j^2 = 2T~,
\end{equation}
其中第二步用到了 $\bvec r_j(q_1,\dots,q_N)$ 的\enref{全微分}{TDiff}，注意该函数不能\enref{显含}{PChain} $t$。 上式代回\autoref{eq_HamCan_1}， 有 $H = 2T - (T - V) = T + V$ 即系统总能量。 证毕。

\subsection{哈密顿方程}
\textbf{哈密顿方程（Hamilton's equations）}也叫\textbf{哈密顿正则方程（Hamilton's canonical equations）}是一组关于广义坐标和广义动量的微分方程组， 共有 $2N$ 条方程：
\begin{equation}\label{eq_HamCan_2}
\dot q_i = \pdv{H}{p_i}~,
\qquad
\dot p_i = -\pdv{H}{q_i}
\qquad
(i = 1\dots N)
\end{equation}
推导见下文。 与拉格朗日方程相比， 虽然方程的个数多了一倍， 但是方程却由二阶变为了一阶。 可见在方程中， $q$ 和 $p$ 是对称的， 具有同样的地位。

\begin{example}{直角坐标系中的质点运动}
直角坐标系中一个质点的拉格朗日量为 $L = m(\dot x^2 + \dot y^2 + \dot z^2)/2 - V$， 易得共轭动量就是通常定义的动量（用 $x_1,x_2,x_3$ 表示 $x, y, z$）
\begin{equation}
p_{x_i} = \pdv{L}{\dot x_i} = m\dot x_i \qquad \text{(i = 1,2,3)}~.
\end{equation}
哈密顿量等于总能量（注意要写成 $x_i$ 和 $p_{x_i}$ 的函数， 不能含有 $\dot x_i$）为
\begin{equation}
H = \sum_i \frac{p_{x_i}^2}{2m} + V~,
\end{equation}
代入哈密顿方程得
\begin{equation}
\dot x_i = \frac{p_{x_i}}{m}~,
\qquad
\dot p_{x_i} = -\pdv{V}{x_i}
\qquad (i = 1,2,3)
\end{equation}
显然上式的第一条是（普通）动量与速度的关系， 第二条则是牛顿第二定律。
\end{example}

\begin{example}{中心力场问题}\label{ex_HamCan_1}
在\autoref{eq_Lagrng_2} 的基础上， 广义坐标 $r, \theta$ 的广义动量分别为 $p_r = m\dot r$ 和 $L = mr^2\dot \theta$。 可以写出质点的哈密顿量（即能量）为
\begin{equation}\label{eq_HamCan_3}
H = T + V = \frac12 m(\dot r^2 + r^2 \dot \theta^2) + V(r) = \frac{p_r^2}{2m} + \frac{L^2}{2mr^2} + V(r)~,
\end{equation}
代入哈密顿方程得
\begin{equation}
m\ddot r = mr \dot \theta^2 - \pdv{V}{r}~,
\end{equation}
以及角动量守恒 $\dot L = 0$。
\end{example}

\subsubsection{额外的广义力}
在 “\enref{拉格朗日方程（额外广义力）}{LagEqQ}” 中，我们讨论了若存在额外广义力 $Q_i^{(e)}$ 该如何拓展哈密顿方程。 那么同样地， 哈密顿正则方程\autoref{eq_HamCan_2} 也可以拓展为
\begin{equation}\label{eq_HamCan_5}
\dot q_i = \pdv{H}{p_i}~,
\qquad
\dot p_i = -\pdv{H}{q_i} + Q_i^{(e)}
\qquad
(i = 1\dots N)~,
\end{equation}
该式和牛顿三定律是等效的。

\subsection{哈密顿正则方程的推导}
现在推导\autoref{eq_HamCan_5}。 对\autoref{eq_HamCan_1} \enref{全微分}{TDiff}，有
\begin{equation}\label{eq_HamCan_9}
\dd{H} = \sum_i \dot q_i \dd{p_i} + \sum_i p_i \dd{\dot q_i} - \dd{L}~,
\end{equation}
其中对拉格朗日量全微分为
\begin{equation}
\dd{L} = \sum_i \pdv{L}{q_i}\dd{q_i} + \sum_i \pdv{L}{\dot q_i}\dd{\dot q_i} + \pdv{L}{t}\dd{t}~.
\end{equation}
将含广义力的拉格朗日方程（\autoref{eq_LagEqQ_1}） 的右边和广义动量的定义（\autoref{eq_Lagrng_13}） 代入该式， 得
\begin{equation}
\dd{L} = \sum_i (\dot p_i - Q_i^{(e)})\dd{q_i} + \sum_i p_i\dd{\dot q_i} + \pdv{L}{t}\dd{t}~,
\end{equation}
代入\autoref{eq_HamCan_9}， 得
\begin{equation}
\dd{H} = - \sum_i (\dot p_i - Q_i^{(e)}) \dd{q_i} + \sum_i \dot q_i \dd{p_i}  - \pdv{L}{t}\dd{t}~.
\end{equation}
由于 $H$ 是 $p_i, q_i, t$ 的函数， 其全微分为 
\begin{equation}
\dd{H} = \sum_i \pdv{H}{q_i}\dd{q_i} + \sum_i \pdv{H}{p_i}\dd{p_i} + \pdv{H}{t}\dd{t}~,
\end{equation}
最后， 对比以上两式可得哈密顿正则方程的拓展形式（\autoref{eq_HamCan_5}）， 以及
\begin{equation}
\pdv{H}{t} = - \pdv{L}{t}~.
\end{equation}
