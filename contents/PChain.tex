% 复合函数的偏导、链式法则（多元微积分）
% 多元微积分|导数|偏导数|全微分|复合函数求导|链式法则

\pentry{全微分\upref{TDiff}， 复合函数求导\upref{ChainR}}


先来看一个二元函数的例子： 若已知二元函数 $z = f(u,v)$，$z$ 是 $u, v$ 的函数，但若 $u$ 和 $v$ 都又是 $x$ 和 $y$ 的函数，则 $z$ 最终是 $x$ 和 $y$ 的函数，即
\begin{equation}\label{eq_PChain_1}
z(x,y) = f[u(x,y),v(x,y)]~.
\end{equation}
那如何求 $z(x,y)$ 的偏导数呢？我们先来看全微分关系\upref{TDiff}
\begin{equation}
\dd{z} = \pdv{f}{u} \dd{u} + \pdv{f}{v} \dd{v}~.
\end{equation}
而 $u$ 和 $v$ 作为 $x, y$ 的函数， 它们的微小变化又都是由 $x$ 和 $y$ 的微小变化引起的， 所以有全微分
\begin{equation}
\dd{u} = \pdv{u}{x} \dd{x} + \pdv{u}{y} \dd{y}~,
\quad
\dd{v} = \pdv{v}{x} \dd{x} + \pdv{v}{y} \dd{y}~.
\end{equation}
代入上式得
\begin{equation}\ali{
\dd{z} &= \pdv{f}{u} \qty( \pdv{u}{x} \dd{x} + \pdv{u}{y} \dd{y} ) + \pdv{f}{v} \qty( \pdv{v}{x}\dd{x} + \pdv{v}{y} \dd{y} ) \\
   &= \qty( \pdv{f}{u}\pdv{u}{x} + \pdv{f}{v}\pdv{v}{x} )\dd{x} + \qty( \pdv{f}{u}\pdv{u}{y} + \pdv{f}{v}\pdv{v}{y} ) \dd{y}~,
}\end{equation}
这就是 $z$ 关于 $x$ 和 $y$ 的全微分关系。根据偏导数的定义
\begin{equation}
\pdv{z}{x} = \pdv{f}{u}\pdv{u}{x} + \pdv{f}{v}\pdv{v}{x}~,
\end{equation}
\begin{equation}
\pdv{z}{y} = \pdv{f}{u}\pdv{u}{y} + \pdv{f}{v}\pdv{v}{y}~.
\end{equation}
这也叫偏导的\textbf{链式法则}。 为了方便我们也会把 $\pdv*{z}{x}$ 和 $\pdv*{z}{y}$ 分别记为 $\pdv*{f}{x}$ 和 $\pdv*{f}{y}$， 但有可能产生歧义。

我们可以把以上的例子拓展到任意多个变量的情况， 即令
\begin{equation}\label{eq_PChain_2}
z(x_1, \dots, x_N) = f[u_1(x_1, \dots, x_N), \dots, u_M(x_1, \dots, x_N)]~.
\end{equation}
这时链式法则可以记为
\begin{equation}
\pdv{z}{x_i} = \sum_j \pdv{f}{u_j}\pdv{u_j}{x_i}~.
\end{equation}

\begin{example}{}
令 $u(x,y) = x + y$， $v(x,y) = x - y$， $f(u, v) = u^2 + v^2$， 求 $\pdv*{f}{x}$ 和 $\pdv*{f}{y}$。

解： 直接套用\autoref{eq_PChain_1} 得
\begin{equation}
\pdv{f}{x} = 2u \cdot 1 + 2v \cdot 1 = 4x~,
\end{equation}
\begin{equation}
\pdv{f}{y} = 2u \cdot 1 + 2v \cdot (-1) = 4y~.
\end{equation}

为了验证，我们也可以直接写出
\begin{equation}
f(x, y) = (x+y)^2 + (x-y)^2 = 2x^2 + 2y^2~.
\end{equation}
再直接求偏导得 $\pdv*{f}{x} = 4x$， $\pdv*{f}{y} = 4y$， 可见结果也是相同的。
\end{example}

\subsection{显含}\label{sub_PChain_1}
在物理中， 尤其在分析力学中， 我们通常会遇见\textbf{显含（explicitly depends on）}的概念。 当
\begin{equation}
f(u_1, \dots, u_M)~
\end{equation}
中的某个 $u_i$ 满足 $\pdv*{f}{u_i}$ 不恒为零时， 我们说 $f$ \textbf{显含} $u_i$。 特殊地， 当某个 $u_i(x_1, \dots, x_N) = x_j$ 时， 我们就说函数 $f$ \textbf{显含} $x_j$， 否则就说 $f$ \textbf{不显含} $x_j$。

若 $f$ 不显含 $x_j$， 但某个 $u_i$ 满足 $\pdv*{u_i}{x_j}$ 不恒为零， 我们就说 $f$ \textbf{隐含（implicitly depends on）} $x_j$。

\begin{example}{}
一个质点延着一条静止轨道 $y = 0$ 运动， 它的动能\upref{KELaw1}为 $E(v_x) = m v_x^2$。 虽然速度 $v_x$ 是时间 $t$ 的函数， 但我们说 $E(v_x)$ 不显含时间。

若轨道在 $y$ 方向具有随时间变化的速度 $v_y(t) = a t^2$， 如果把动能记为 $E(v_x, v_y) = m(v_x^2 + v_y^2)$， 那么该函数仍然不显含 $t$。

仍然令 $v_y(t) = a t^2$， 但把动能记为 $E(v_x, t) = m v_x^2 + m (a t^2)^2$， 那么该函数就显含 $t$。

虽然在后两种情况中物理情景都是一样的， 但 $E(v_x, v_y)$ 和 $E(v_x, t)$ 在数学上却是两个不同的函数， 使用了通用函数名 $E$。 这两个函数分别是 $f(x, y) = m(x^2 + y^2)$ 和 $g(x, y) = mx^2 + ma^2 y^4$， 显然不是同一个函数。 它们都显含 $x, y$， 不显含其他任何变量。
\end{example}

\subsubsection{全导数}
特殊地， 当所有的 $u_i$ 都只是一个变量 $x$ 的函数时， 我们可以求全导数\upref{TotDer} $\dv*{f}{x}$。 这时可以分为 $f$ 隐含 $x$ 和显含 $x$ 来讨论。
