% 氢原子球坐标薛定谔方程数值解
% 氢原子|薛定谔方程|线偏振|分波|球谐函数

\pentry{薛定谔方程\upref{TDSE}， 类氢原子的定态波函数\upref{HWF}， Wigner 3j 符号\upref{ThreeJ}}

本文使用原子单位制\upref{AU}． 我们希望求解氢原子在电场中的薛定谔方程
\begin{equation}\label{HyTDSE_eq7}
-\frac{1}{2m}\laplacian \Psi + V(\bvec r, t)\Psi = \I \pdv{t}\Psi
\end{equation}
在薛定谔方程中， 一种简单的做法是使用以下势能表示库仑势能以及电磁场对电子的作用
\begin{equation}\label{HyTDSE_eq8}
V(\bvec r, t) = -\frac{Z}{r} - q\bvec E(t) \vdot \bvec r
\end{equation}
在原子单位中电子电荷 $q = -1$， 该势能使用了长度规范\upref{LenGau}， 此外我们还可以使用速度规范速度规范\upref{LVgaug}， 也是等效的． 在长度规范中， 我们近似认为原子的长度远小于电磁波的波长， 所以电磁波不随位置变化． 本文使用长度规范．

虽然求解方程最直观的方法是使用直角坐标， 但计算效率很低． 实际中一般使用球坐标系， 用球谐函数展开波函数（参考球坐标系中的定态薛定谔方程\upref{RadSE}）．
\begin{equation}\label{HyTDSE_eq3}
\Psi(\bvec r, t) = \frac{1}{r}\sum_{l,m} \psi_{l,m}(r, t) Y_{l,m}(\bvec r)
\end{equation}
其中 $\psi_{l,m}(r, t)$ 是\textbf{约化径向波函数（scaled radial wave function）}， 式中每一项叫做一个\textbf{分波（partial wave）}． 如果哈密顿算符是关于 $z$ 轴对称的（例如线偏振电场）， 且初始波函数也轴对称， 那么波函数将始终保持轴对称． 这时只需要 $m = 0$ 的球谐函数， 即勒让德多项式（见\autoref{SphHar_eq11}~\upref{SphHar}）．

\subsection{线偏振光}
若我们取电场极化方向为 $\uvec z$， 则角动量 $L_z$ 是一个守恒量． 假设初始波函数关于 $\uvec z$ 轴对称， 那么在波函数的整个演化（propagation）过程中， 我们只需要 $m=0$ 的球谐函数展开波函数， 即
\begin{equation}
\Psi(\bvec r, t) = \frac{1}{r}\sum_{l'} \psi_{l'}(r, t) Y_{l', 0}(\uvec r)
\end{equation}
另外薛定谔方程中 $V(\bvec r, t) = \bvec E(t) \vdot \bvec r = E(t) z$， 进而可以用球谐函数表示（\autoref{SphHar_eq4}~\upref{SphHar}）
\begin{equation}
V(\bvec r, t) = \sqrt{\frac{4\pi}{3}} E(t) r \cdot Y_{1,0}(\uvec r)
\end{equation}
以上两式代入\autoref{HyTDSE_eq7}， 再把每一项与 $Y_{l,0}(\uvec r)$ 做内积（放入积分 $\int Y_{1,0}^*(\uvec r) \dd{\Omega}$ 中）可得一系列耦合的方程
\begin{equation}\label{HyTDSE_eq4}
H_0 \psi_{l} + E(t)r\sum_{l' = 0}^{\infty} F_{l, l'} \psi_{l'} = \I \pdv{\psi_{l}}{t} \quad (l=0,1,\dots)
\end{equation}
其中无场哈密顿算符为
\begin{equation}
H_0 = -\frac{1}{2m} \dv[2]{r} -\frac{Z}{r} + \frac{l(l+1)}{2mr^2}
\end{equation}
矩阵 $\mat F$ 就是跃迁偶极子矩阵的角向积分（\autoref{SphHar_eq5}~\upref{SphHar}）
\begin{equation}
\begin{aligned}
F_{l,l'} &= \sqrt{\frac{4\pi}{3}} \mel{Y_{l,0}}{Y_{1,0}}{Y_{l',0}}\\
&= \sqrt{(2l+1)(2l'+1)} \pmat{l & 1 & l'\\ 0 & 0 & 0}^2\\
&= \sqrt{\frac{2l+1}{2l'+1}} \bmat{l & 1 & l'\\ 0 & 0 & 0}^2
\end{aligned}
\end{equation}
可见， 当没有外场的时候每一个项（即每一个分波）都可以独立演化， 而电场将不同的分波耦合起来． 根据氢原子的选择定则 $\Delta l = \pm 1$（\autoref{SelRul_eq2}~\upref{SelRul}）， 矩阵 $\mat F$ 中除了两条副对角线上的元都为零． 另外由\autoref{ThreeJ_eq2}~\upref{ThreeJ} 易得 $\mat F$ 是一个对称矩阵．

\subsection{任意偏振光}
将所有 $(l,m)$ 按某种顺序排列，例如
\begin{equation}
(0, 0),\ (1,-1),\ (1,0),\ (1,1),\ (2,-2), \dots
\end{equation}
并将他们编号为 $\lambda = 1,2, \dots$， 那么可以把\autoref{HyTDSE_eq3} 记为
\begin{equation}
\Psi(\bvec r, t) = \frac{1}{r}\sum_\lambda \psi_\lambda(r) Y_\lambda(\bvec r)
\end{equation}
势能函数为 $V(\bvec r, t) = \bvec E(t) \vdot \bvec r  = E_x x + E_y y + E_z z$． 其中 $x,y,z$ 可以用球谐函数表示为（\autoref{SphHar_eq4}~\upref{SphHar}）
\begin{equation}
x = \sqrt{\frac{2\pi}{3}} r (Y_{1,-1} - Y_{1,1})~, \qquad
y = \I \sqrt{\frac{2\pi}{3}} r (Y_{1,-1}+Y_{1,1})~, \qquad
z = \sqrt{\frac{4\pi}{3}} rY_{1,0}
\end{equation}

\autoref{HyTDSE_eq4} 的耦合方程拓展为
\begin{equation}
\begin{aligned}
H_0 \psi_{\lambda}(r) + r \sum_{\lambda'} \qty[E_x(t) F_{\lambda, \lambda'}^{x} + E_y(t) F_{\lambda, \lambda'}^{y} + E_z(t) F_{\lambda, \lambda'}^{z}] \psi_{\lambda'}(r) \\
= \I \pdv{\psi_{\lambda}}{t} \quad (\lambda=0,1,\dots)
\end{aligned}
\end{equation}
三个耦合矩阵分别为
\begin{equation}
\begin{aligned}
F_{\lambda,\lambda'}^{x} = \sqrt{\frac{2\pi}{3}} E_x \qty(\mel{Y_{l,m}}{Y_{1,-1}}{Y_{l',m'}} - \mel{Y_{l,m}}{Y_{1,1}}{Y_{l',m'}})
\end{aligned}
\end{equation}
\begin{equation}
\begin{aligned}
F_{\lambda,\lambda'}^{y} = \I\sqrt{\frac{2\pi}{3}} E_y \qty(\mel{Y_{l,m}}{Y_{1,-1}}{Y_{l',m'}} + \mel{Y_{l,m}}{Y_{1,1}}{Y_{l',m'}})
\end{aligned}
\end{equation}
\begin{equation}
\begin{aligned}
F_{\lambda,\lambda'}^{z} = \sqrt{\frac{4\pi}{3}} E_z \mel{Y_{l,m}}{Y_{1,0}}{Y_{l',m'}}
\end{aligned}
\end{equation}
其中（\autoref{SphHar_eq5}~\upref{SphHar}）
\begin{equation}
\mel{Y_{l,m}}{Y_{1,m_1}}{Y_{l',m'}} = (-1)^m\sqrt{\frac{3(2l+1)(2l'+1)}{4\pi}} \pmat{l & 1 & l'\\ 0 & 0 & 0}\pmat{l & 1 & l'\\ -m & m_1 & m'}
\end{equation}

\subsection{任意含时势能}
如果要给\autoref{HyTDSE_eq8} 加上一个额外的势能项 $V'(\bvec r, t)$， 首先需要用球谐函数进行分解
\begin{equation}\label{HyTDSE_eq6}
V'(\bvec r, t) = \sum_{l,m} V'_{l,m}(r, t) Y_{l,m}(\uvec r)
\end{equation}
那么耦合矩阵元为（\autoref{SphHar_eq5}~\upref{SphHar}）
\begin{equation}\label{HyTDSE_eq5}
F'_{\lambda,\lambda'}(r, t) = \mel{Y_{l'',m''}}{V'(\bvec r, t)}{Y_{l',m'}} = \sum_{l,m} V'_{l,m}(r, t) \mel{Y_{l'',m''}}{Y_{l,m}}{Y_{l',m'}}
\end{equation}
\begin{equation}
\mel{Y_{l'',m''}}{Y_{l,m}}{Y_{l',m'}} = (-1)^{m''}\sqrt{\frac{(2l''+1)(2l+1)(2l'+1)}{4\pi}} \pmat{l''& l& l'\\ 0 & 0 & 0}\pmat{l'' & l & l'\\  -m'' & m & m'}
\end{equation}
在程序中， 可以把 $\mel{Y_{l'',m''}}{Y_{l,m}}{Y_{l',m'}}$ 表示为三维数组 \verb|F1(λ'', λ', λ)|， 然后在每个 $r$ 格点对 \verb|λ| 加权求和得到二维方阵．

对 $m = 0$ 的对称情况， $\mel{Y_{l'',m''}}{Y_{l,m}}{Y_{l',m'}}$ 在 $l = 0$ 时是一个对角矩阵， $l = 1$ 时只有两个 1-副对角线不为零， $l = 2$ 时只有对角线和两个 2-副对角线不为零， 以此类推． 左上角的三角形也会等于零（见\autoref{AMAdd_fig2}~\upref{AMAdd}）． 耦合薛定谔方程变为
\begin{equation}
H_0 \psi_{l} + E(t)r\sum_{l' = 0}^{\infty} F_{l, l'} \psi_{l'} + \sum_{l'=0}^\infty F'_{l,l'}(r, t)\psi_{l'} = \I \pdv{\psi_{l}}{t} \quad (l=0,1,\dots)
\end{equation}

在下面介绍的算符拆分中， 若把 $F'$ 矩阵对角线上的元合并到 $H_0$ 中很可能会减小误差．

\subsection{算符拆分}
在实际的程序中， 我们可以把演化子 $\exp(-\I H \Delta t)$ 拆成 3 项． 虽然这么做会引入一定的误差， 但是却大大提高了效率
\begin{equation}\label{HyTDSE_eq2}
\exp(-\I H \Delta t) = \exp(-\I H_0 \frac{\Delta t}{2}) \exp(-\I H_1 \Delta t)\exp(-\I H_0 \frac{\Delta t}{2}) + \order{\Delta t^3}
\end{equation}

例如对于线偏振光（\autoref{HyTDSE_eq4}）， 在每个时间步长 $\Delta t$ 中， 我们可以把波函数先根据方程
\begin{equation}\label{HyTDSE_eq1}
H_0 \psi_{l} = \I \pdv{\psi_{l}}{t}
\end{equation}
演化 $\Delta t/2$， 其中 $t_{mid}$ 取这段时间的中点． 再对每个 $r$ 根据方程
\begin{equation}\label{HyTDSE_eq9}
\sum_{l'} E(t_{mid})rF_{l, l'} \psi_{l'} = \I \pdv{\psi_{l}}{t}
\end{equation}
演化 $\Delta t$． 最后再根据\autoref{HyTDSE_eq1} 演化 $\Delta t/2$． 具体演化算法有多种， 将在下面介绍．

理论上也可以把演化子划分成两项 $\exp(-\I H_1 \Delta t)\exp(-\I H_0 {\Delta t})$ 但据说\autoref{HyTDSE_eq2} 更精确． 至于相邻两步之间产生的 $\exp(-\I H_0 {\Delta t}/{2})\exp(-\I H_0 {\Delta t}/{2})$ 是否可以合并为 $\exp(-\I H_0 {\Delta t})$， 取决于所使用的算法这么做以后是否会引入额外误差．

\subsection{网格和演化算法}
\pentry{Crank-Nicolson 算法（一维）\upref{CraNic}}
\addTODO{以下内容应该放在一维薛定谔方程里面讲解}

可以使用二维数组储存波函数， 每一列（或行）是一个分波的 $\psi_l(r)$． 径向网格可以使用等间距网格， 但 FEDVR 网格\upref{FEDVR}效率要更高．

演化可以并使用 Crank-Nicolson 算法Crank-Nicolson 算法（一维）\upref{CraNic}演化． 但是 Lanczos 算法\upref{Lanc}效率更高， 而且可以实时判断误差改变步长．
