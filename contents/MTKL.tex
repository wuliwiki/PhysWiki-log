% 蒙特卡罗方法（综述）
% license CCBYSA3
% type Wiki

本文根据 CC-BY-SA 协议转载翻译自维基百科\href{https://en.wikipedia.org/wiki/Monte_Carlo_method}{相关文章}。

蒙特卡罗方法，又称蒙特卡罗实验，是一类依赖重复随机抽样以获得数值解的广义计算算法。其基本思想是利用随机性来解决一些本质上可能是确定性的问题。该名称源自摩纳哥的蒙特卡罗赌场，该方法的主要发展者、数学家斯坦尼斯瓦夫·乌拉姆受到他叔叔赌博习惯的启发而命名。

蒙特卡罗方法主要用于三类问题：优化问题，数值积分，从概率分布中抽样生成样本。此外，它还可以用于对输入存在高度不确定性的现象进行建模，例如评估核电站故障的风险。蒙特卡罗方法通常通过计算机模拟实现，能为那些无法解析求解或过于复杂的问题提供近似解。

蒙特卡罗方法广泛应用于多个科学与工程领域，包括：物理、化学、生物学、统计学、人工智能、金融、密码学，也被应用于社会科学，如：社会学、心理学与政治学。它被认为是20世纪最重要且最具影响力的思想之一，并推动了众多科学与技术突破的实现。

不过，蒙特卡罗方法也存在一些局限性和挑战，例如：精度与计算成本之间的权衡，维度灾难，随机数生成器的可靠性，结果的验证与确认。
\subsection{概述}
蒙特卡罗方法虽然形式多样，但通常遵循以下基本步骤：
\begin{enumerate}
\item 定义可能输入的范围（即问题的定义域）；
\item 从该范围内的概率分布中随机生成输入样本；
\item 对每个输入进行确定性的计算，得到输出结果；
\item 汇总（聚合）所有结果，以得到最终的估计或解。
\end{enumerate}
\begin{figure}[ht]
\centering
\includegraphics[width=6cm]{./figures/db49926bb4b1422c.png}
\caption{蒙特卡罗方法用于近似计算\(\pi\)的值} \label{fig_MTKL_1}
\end{figure}
例如，考虑一个内接于单位正方形的象限圆扇形。由于它们面积的比值是 $\frac{\pi}{4}$，因此可以使用蒙特卡罗方法来近似计算 $\pi$ 的值：\(^\text{[1]}\)
\begin{enumerate}
\item 画一个正方形，并在其中内接一个象限圆（四分之一圆）；
\item 在正方形内均匀随机撒布一定数量的点；
\item 统计落在象限圆内的点的数量（即其到原点的距离小于1的点）；
\item 象限内点数与总点数之比是两者面积比 $\frac{\pi}{4}$ 的估计值。
将该比值乘以4，即可得到 $\pi$ 的估计值。
\end{enumerate}
在上述过程中，输入的定义域是包围该象限的正方形。可以通过在正方形内随机撒点（如撒沙粒）来生成输入，然后对每个输入执行一次计算，以判断它是否落在象限圆内。将结果汇总后，就可以得到最终的估计值——对 $\pi$ 的近似。

这里有两个重要注意事项：
\begin{enumerate}
\item 如果点不是均匀分布的，则估计结果将不准确；
\item 随机点的数量越多，估计的精度就越高。
\end{enumerate}
蒙特卡罗方法的应用需要大量的随机数，因此它的发展极大地受益于伪随机数生成器的出现，这些生成器比早期所用的随机数表要高效得多。
\subsection{应用}
蒙特卡罗方法常用于物理和数学问题，尤其在其他方法难以或无法使用时最为有用。蒙特卡罗方法主要应用于三类问题：\(^\text{[2]}\)：优化问题，数值积分，从概率分布中生成样本（抽样）。

在与物理相关的问题中，蒙特卡罗方法非常适用于模拟具有多个耦合自由度的系统，例如流体、无序材料、强耦合固体以及细胞结构等（参见：细胞 Potts 模型、相互作用粒子系统、McKean–Vlasov 过程、气体动力学模型）。

其他应用示例包括：建模输入存在重大不确定性的现象，例如商业风险评估；在数学中，用于求解具有复杂边界条件的多维定积分；在系统工程问题中（如航天、石油勘探、飞机设计等），蒙特卡罗方法在预测失效概率、成本超支和进度延误方面，往往优于人类直觉或其他“软性”方法。\(^\text{[3]}\)

从原理上讲，任何具有概率解释的问题都可以使用蒙特卡罗方法求解。根据大数定律，由某随机变量期望值所定义的积分可以通过该变量的独立样本的经验平均值（即样本均值）来近似。当所研究的随机变量具有参数化的概率分布时，数学家通常会使用马尔可夫链蒙特卡罗方法（MCMC）。\(^\text{[4][5][6]}\) 其核心思想是构造一个具有指定平稳分布的合适马尔可夫链模型。也就是说，在极限下，由 MCMC 方法生成的样本将来自目标分布。\(^\text{[7][8]}\)根据遍历定理，该平稳分布可以通过 MCMC 采样器生成的随机状态的经验分布来近似。

在其他类型的问题中，目标是从满足非线性演化方程的一系列概率分布中生成样本。这些概率分布的演化流总可以解释为某个马尔可夫过程的随机状态分布，其转移概率依赖于当前状态的分布（参见：McKean–Vlasov 过程、非线性滤波方程）。\(^\text{[9][10]}\)在另外一些情形下，会出现采样复杂度不断上升的概率分布流，例如：随时间增长的路径空间模型，与降温参数相关的玻尔兹曼–吉布斯测度，以及其他类似模型。这些模型也可以看作是非线性马尔可夫链的随机状态分布的演化过程。\(^\text{[10][11]}\)一种模拟此类复杂非线性马尔可夫过程的自然方法是：对该过程生成多个独立副本，用样本的经验分布来替代演化方程中未知的状态分布。与传统蒙特卡罗或 MCMC 方法不同，这些被称为平均场粒子方法的方法依赖于一组连续相互作用的样本。术语“平均场”指的是，每一个样本（也称为粒子、个体、行者、代理、实体或表型）都与过程的经验分布发生相互作用。当系统规模趋于无穷大时，这些随机的经验测度将收敛到非线性马尔可夫链中随机状态的确定性分布，从而粒子之间的统计相互作用也将消失。
\subsection{简单蒙特卡罗方法}
假设我们希望知道某个总体的期望值 $\mu$（且已知该期望值存在），但无法通过公式直接计算。简单蒙特卡罗方法通过运行 $n$ 次模拟并对结果取平均，来对 $\mu$ 进行估计。

该方法对模拟输入的概率分布没有限制，只要求以下几点：输入是随机生成的，输入彼此相互独立，$\mu$存在。只要 $n$ 足够大，所得估计值 $m$ 就能**任意接近于**真实值 $\mu$。更正式地说，对于任意 $\epsilon > 0$，都可以有$|\mu - m| \leq \epsilon$\(^\text{[12]}\)

通常用于计算 $m$ 的算法如下：
\begin{figure}[ht]
\centering
\includegraphics[width=14.25cm]{./figures/99fbcdd21ea48ed3.png}
\caption{} \label{fig_MTKL_2}
\end{figure}
\subsubsection{一个示例}
假设我们想知道：掷三个八面骰子，总点数至少为 $T$，我们期望需要掷多少次才能满足这一条件。我们知道该期望值是存在的。骰子的每次投掷是随机的且相互独立的，因此可以应用简单蒙特卡罗方法：
\begin{figure}[ht]
\centering
\includegraphics[width=14.25cm]{./figures/679fe4eb3bb18f45.png}
\caption{} \label{fig_MTKL_3}
\end{figure}
如果 $n$ 足够大，则对于任意 $\epsilon > 0$，估计值 $m$ 将会落在真实值 $\mu$ 的 $\epsilon$ 范围内。
\subsection{确定足够大的 $n$}

\textbf{通用公式}

设$\epsilon = |\mu - m| > 0$，其中 $\mu$ 是真实期望值，$m$ 是蒙特卡罗估计值。首先，选择所需的置信水平——也就是希望在蒙特卡罗算法运行完成后，估计值$m$落在$\mu$的$\epsilon$ 范围内的概率。设对应该置信水平的标准正态$z$-分数为 $z$。

设$s^2$为估计方差（有时称为“样本方差”），它是从一个相对较小的样本数量 $k$ 次模拟中计算得到的结果的方差。选择一个$k$值；Driels 和 Shin 指出：“即使样本量比所需数量小一个数量级，这个估算结果通常也相当稳定。”\(^\text{[13]}\)

以下算法可以单遍计算 $s^2$，同时最小化累积数值误差导致的错误结果风险：\(^\text{[12]}\)
\begin{figure}[ht]
\centering
\includegraphics[width=14.25cm]{./figures/8dcfec3f3fc4e736.png}
\caption{} \label{fig_MTKL_4}
\end{figure}
请注意，当算法运行结束时，$m_k$是从 $k$ 次模拟中得到的平均值。

当满足以下条件时，$n$ 被认为是足够大的：
$$
n \geq \frac{s^2 z^2}{\epsilon^2},^\text{[12][13]}~
$$
如果$n \leq k$，那么$m_k = m$,说明已有的 $k$ 次模拟已足以保证 $m_k$ 在误差 $\epsilon$ 范围内逼近 $\mu$。如果$n > k$,那么可以选择：重新“从头开始”运行 $n$ 次模拟，或因为已完成了 $k$ 次模拟，只需再运行 $n - k$ 次模拟，并将它们的结果加入原来的样本统计中即可：
\begin{figure}[ht]
\centering
\includegraphics[width=14.25cm]{./figures/e52479c12430563f.png}
\caption{} \label{fig_MTKL_5}
\end{figure}
\textbf{当模拟结果有界时的估算公式}

在所有模拟结果都有上下界的特例中，可以使用另一种估算公式。

选择一个 $\epsilon$ 值，使其为 $\mu$ 与 $m$ 之间最大允许误差的两倍。设置信心水平 $\delta$，满足$0 < \delta < 100$,并以百分比表示。假设每次模拟结果$r_1, r_2, \ldots, r_i, \ldots, r_n$都满足$a \leq r_i \leq b$，其中 $a$ 和 $b$ 是有限实数。若希望以至少 $\delta\%$ 的置信度满足$|\mu - m| < \epsilon/2$,

则应选择满足以下条件的 $n$：
$$
n \geq 2(b - a)^2 \ln\left(2/(1 - (\delta/100))\right)/\epsilon^2~
$$
例如，若 $\delta = 99\%$，则有：$n \geq 2(b - a)^2 \ln(2 / 0.01)/\epsilon^2 \approx 10.6(b - a)^2/\epsilon^2$.\(^\text{[12]}\)
\subsection{计算成本}
尽管蒙特卡罗方法在概念和算法上都非常简单，但其计算成本可能极其高昂。一般而言，该方法需要大量样本才能获得良好的近似结果，而如果每个样本的处理时间很长，那么总运行时间可能会大得无法接受。\(^\text{[14]}\)尽管这一点在处理非常复杂的问题时是一个严重的限制，但该算法具有天然的“尴尬并行性”，因此可以通过各种并行计算策略来降低这一高昂成本，使其达到可行的水平，例如使用：本地多处理器，计算集群，云计算，GPU（图形处理器），FPGA（现场可编程门阵列）等。\(^\text{[15][16][17][18]}\)
\subsection{历史}
在蒙特卡罗方法发展之前，模拟通常是用于测试已知的确定性问题，而统计抽样则被用于估算这些模拟中的不确定性。蒙特卡罗模拟则反其道而行之，利用概率性元启发式方法（如模拟退火）来求解确定性问题。

蒙特卡罗方法的一个早期变种用于解决著名的布丰投针问题，该问题通过向平行等距条纹地板上投掷针来估算圆周率 $\pi$。20世纪30年代，恩里科·费米在研究中子扩散问题时首次尝试了蒙特卡罗方法，但他并未发表相关研究成果。\(^\text{[19]}\)

20世纪40年代末，斯坦尼斯瓦夫·乌拉姆在美国洛斯阿拉莫斯国家实验室参与核武器项目期间，发明了现代版本的马尔可夫链蒙特卡罗方法。1946年，洛斯阿拉莫斯的核武器物理学家正在研究核武器核心中中子的扩散问题。\(^\text{[19]}\)尽管他们掌握了大部分必要的数据，比如中子在物质中与原子核发生碰撞之前的平均行进距离，以及中子发生碰撞后可能释放的能量等，但他们无法用传统的确定性数学方法解决这个问题。乌拉姆提出可以使用随机实验来处理此类问题。他这样回忆当时的灵感来源：

我第一次尝试实践[蒙特卡罗方法]的想法，是源于1946年一个我在患病康复期间玩纸牌游戏（单人接龙）时想到的问题。当时我在想：用52张牌摆出的 Canfield 单人接龙游戏成功的几率有多大？我花了很长时间试图通过纯粹的组合计算来估算它，但后来我开始思考，是否有比“抽象思维”更实用的方法，比如干脆实际玩一百次，然后观察并统计成功次数。由于当时正值高速计算机新时代的开端，这个思路开始变得可行。我很快就联想到中子扩散问题及其他数学物理问题，进而更一般地思考，如何将某些微分方程所描述的过程转化为一系列可解释为随机操作的等效形式。后来（也是在1946年），我把这个想法讲给约翰·冯·诺依曼听，我们开始计划实际的计算工作。\(^\text{[20]}\)

由于相关工作属于机密，冯·诺依曼和乌拉姆的研究需要一个代号。\(^\text{[21]}\)他们的同事尼古拉斯·梅特罗波利斯提议使用“蒙特卡罗”这个名称，来源于摩纳哥的蒙特卡罗赌场，乌拉姆的叔叔曾常常向亲戚借钱去那里赌博。\(^\text{[19]}\)蒙特卡罗方法在战后核武器进一步发展的模拟计算中发挥了核心作用，包括氢弹的设计，尽管当时的计算工具极其有限。1948年春，冯·诺依曼、尼古拉斯·梅特罗波利斯及其他人使用ENIAC 计算机进行了首次完全自动化的蒙特卡罗计算，模拟对象是裂变武器核心。\(^\text{[22]}\)到了20世纪50年代，洛斯阿拉莫斯国家实验室在氢弹研发中大量应用了蒙特卡罗方法，该方法也逐渐在物理学、物理化学和运筹学等领域普及开来。兰德公司和美国空军是当时推广和资助蒙特卡罗方法研究的两大主要机构，该方法随后在许多不同领域中得到广泛应用。

更为复杂的平均场类型粒子蒙特卡罗方法的理论，最迟在20世纪60年代中期就已开始发展，起始于亨利·P·麦基恩二世关于流体力学中出现的一类非线性抛物型偏微分方程的马尔可夫解释的研究。\(^\text{[23][24]}\)而更早的一篇开创性文章由西奥多·E·哈里斯和赫尔曼·卡恩于1951年发表，文章中使用了平均场遗传类型的蒙特卡罗方法来估算粒子的传输能量。\(^\text{[25]}\)平均场遗传类型的蒙特卡罗方法也被用作进化计算中的自然启发式搜索算法（又称元启发式算法，metaheuristic）。这种平均场计算技术的起源可以追溯到：1950年和1954年，艾伦·图灵关于遗传型突变–选择学习机的工作，\(^\text{[26]}\)以及尼尔斯·奥尔·巴里切利在新泽西普林斯顿高等研究院发表的相关论文。\(^\text{[27][28]}\)

量子蒙特卡罗方法，特别是扩散蒙特卡罗方法，也可以被解释为对费曼–卡克路径积分的平均场粒子蒙特卡罗近似。\(^\text{[29][30][31][32][33][34][35]}\)量子蒙特卡罗方法的起源通常归功于恩里科·费米和罗伯特·里希特迈尔，他们于1948年发展了中子链式反应的平均场粒子解释模型。\(^\text{[36]}\)然而，第一个启发式或遗传型粒子算法（又称重采样蒙特卡罗或重构蒙特卡罗方法）用于估算量子系统基态能量（在约化矩阵模型中），是杰克·H·赫瑟林顿在1984年提出的。\(^\text{[35]}\)在分子化学领域，使用遗传启发式粒子方法（也称为剪枝与增强策略）可以追溯到1955年，由马歇尔·N·罗森布鲁斯和阿丽安娜·W·罗森布鲁斯所开展的开创性工作。\(^\text{[37]}\)

在高级信号处理与贝叶斯推断中使用序贯蒙特卡罗方法是较近才出现的进展。1993年，Gordon 等人在其开创性论文中首次将蒙特卡罗重采样算法应用于贝叶斯统计推断。\(^\text{[38]}\)作者将其算法命名为“自助滤波器”，并指出与其他滤波方法相比，该算法不需要对状态空间或系统噪声作出任何假设。该领域的另一篇奠基性文章是北川源四郎关于相关的“蒙特卡罗滤波器”的研究。\(^\text{[39]}\)同时期还有皮埃尔·德尔·莫拉尔，\(^\text{[40]}\)以及 Himilcon Carvalho、Pierre Del Moral、André Monin 与 Gérard Salut 合作发表的关于粒子滤波器的研究论文，这些成果大多发表于1990年代中期。\(^\text{[41]}\)实际上，在1989年至1992年间，P. Del Moral、J. C. Noyer、G. Rigal 和 G. Salut 在法国国家科学研究中心系统分析与架构实验室已在雷达/声纳与GPS信号处理领域开发出粒子滤波算法，这些工作曾以保密研究报告的形式提交给法国海军武器工程技术处、IT公司 DIGILOG 及 LAAS-CNRS。\(^\text{[42][43][44][45][46][47]}\)这些序贯蒙特卡罗方法可被理解为：带有相互作用重采样机制的接受–拒绝采样器。

从1950年到1996年，所有关于序贯蒙特卡罗方法的出版物——包括在计算物理和分子化学中提出的剪枝与重采样蒙特卡罗方法——都提出了自然的、类启发式的算法，被应用于各种不同情境，但并未提供算法一致性的证明，也没有讨论估计偏差或基于谱系树与祖先树的算法结构。

该领域的数学基础及对这些粒子算法的首个严格分析由皮埃尔·德尔·莫拉尔于1996年完成。\(^\text{[40][48]}\)到了20世纪90年代末，具有可变粒子数量的分支型粒子方法也得到了发展，主要由丹·克里桑、杰西卡·盖恩斯和特里·里昂斯提出。\(^\text{[49][50][51]}\)之后丹·克里桑、皮埃尔·德尔·莫拉尔与特里·里昂斯共同推动了进一步的研究。\(^\text{[52]}\)1999年至2001年，P. Del Moral、A. Guionnet 和 L. Miclo继续对该领域进行了拓展与深化。\(^\text{[30][53][54]}\)