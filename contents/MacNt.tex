% MacOS 笔记
% license Xiao
% type Note

\subsection{键盘}

\begin{figure}[ht]
\centering
\includegraphics[width=9cm]{./figures/923dac01b16128d9.png}
\caption{Mac 小键盘} \label{fig_MacNt_5}
\end{figure}

\begin{figure}[ht]
\centering
\includegraphics[width=14cm]{./figures/ba4340c2f33d1bad.png}
\caption{Mac 全键盘} \label{fig_MacNt_4}
\end{figure}

\href{https://karabiner-elements.pqrs.org/}{Karabiner-Elements} 是 Mac 上常用的第三方键盘映射软件，可以把一些键映射到别的位置。

\begin{figure}[ht]
\centering
\includegraphics[width=14cm]{./figures/c8ce89b316d60827.png}
\caption{Windows 全键盘} \label{fig_MacNt_3}
\end{figure}

要设置长按按键（例如方向键）的延迟时间和重复频率，在 \verb`System -> Keyboard -> Key repeat rate` 中调节（未测试）。

\subsubsection{使用 Win 键盘}
如果你把 Windows 的标准键盘插到 Mac 上， 那么
\begin{itemize}
\item Mac 的 \verb|Cmd| 是 Windows 的 \verb|Win| 键
\item Mac 的 \verb|Opt| 是 Win 的 \verb|Alt| 键（左右两个分别对应）
\item Mac 的 \verb|Delete| 键是 Windows 的 \verb|Backspace|
\item 但从布局上来看， 左边的 \verb|Win| 和 \verb|Alt| 应该互换一下（可以在系统的键盘设置中更改）
\item \verb|Cmd + W| 关闭当前窗口。 \verb|Cmd + Q| 关闭当前 app。
\item \verb|Ctrl + 上| 桌面管理。
\item \verb|F11| 暂时显示桌面。
\item \verb|Cmd + M| 最小化当前窗口并显示在 dock 上。 \verb`Cmd + H` 隐藏当前 app 的所有窗口包括 docker。 \verb`Cmd + Alt + H` 隐藏当前 app 外的所有窗口， 但这之后 \verb`Cmd + H` 就没用了。
\item \verb|Cmd + Shift + 3| 对整个屏幕截图。 \verb|4| 可以光标截取部分屏幕。
\item \verb|Home| 和 \verb|End| 一般不会跳到行首和行末，要用 \verb|Cmd + 左右箭头| 或者 \verb`Ctrl + A` 或 \verb`Ctrl + E`。
\item 系统默认 F1, F2 等按键为功能键，要改变， \verb`System Settings > Keyboard > Keyboard Shortcuts > Function Keys`
\item 可以用 Karabiner 把 \verb`insert` 键映射到 \verb`fn`。 空格右边四个按键中，只有最左边的 karabiner 可以用 \verb`right_option` 识别（映射到 \verb`right_command`），其他暂时没试出来。
\end{itemize}

\subsubsection{快捷键}
\begin{itemize}
\item \verb|Cmd + c|， \verb|Cmd + v| 复制粘贴
\item \verb|Cmd + c| 然后 \verb|Cmd + Opt + v| 移动文件
\item \verb|Cmd + x| 只能用于剪切文本， 不能剪切文件。
\item \verb|Cmd + Del| 把文件移动到回收站
\item \verb|Cmd + z| 撤销
\item \verb|Cmd + Shift + z| 重做
\item \verb|Cmd + Tab| 切换程序（相当于 Windows 的 \verb`Alt + Tab`），但是最小化的窗口仍然会保持最小化。如果要让它出现，松开 \verb`Tab` 以后按住 \verb`Opt`，松开 \verb`Cmd` 再松开 \verb`Opt` 即可…… （这是什么神仙设计？）。 有一个第三方开源软件 \href{https://alt-tab-macos.netlify.app/}{AltTab} 可以解决这个问题。
\item \verb|Cmd + `| 切换同一个程序的不同窗口
\item \verb|Cmd + Delete| 删除
\item \verb`Cmd + W` 关闭窗口（包括浏览器 tab 和 Finder 等）
\item \verb`Ctrl + 上箭头` （或者 \verb`F3` 对应的功能键）任务管理，在这里可以新建多个桌面
\item \verb`Ctrl + 左/右箭头` 在多个桌面之间切换
\item \verb`Ctrl + Cmd + F` 窗口全屏（最大化）。一个全屏的窗口独占一个新的桌面
\item \verb|Fn + Delete| 向右删除文本（相当于 Windows 的 \verb|Delete|）
\item \verb|Ctrl + 左右箭头| 切换屏幕
\item \verb|Ctrl + 上下箭头| 程序管理
\item \verb|Ctrl + Opt + eject| 睡眠
\item \verb|Ctrl + Opt + Cmd| 关机
\item \verb|Cmd + Opt + ESC| 强制退出
\item \verb|Ctrl + Shift + eject| 关闭屏幕
\item \verb|F11| 临时显示桌面
\item \verb|Cmd + Shift + 3| 全屏截图， \verb|Cmd + Shift + 4| 选择区域截图。
\item \verb|Cmd + 空格| spotlight 搜索
\item \verb|选中文件 + 空格| 预览文件
\item \verb|Ctrl + 空格| 输入法切换。 如果要临时切换到英文输入可以用 Capslock 键，仍然默认输入小写字母。无法设置 shift 切换中英，可以安装第三方输入法如搜狗。
\end{itemize}

\subsubsection{Chrome 快捷键}
\begin{itemize}
\item \verb|Cmd+R| 刷新（相当于 Windows 的 \verb|Ctrl+R| 或者 \verb|F5|）， \verb|Cmd+Shift+R| 硬刷新（不使用缓存，相当于 Windows 的 \verb|Ctrl+Shift+R| 或 \verb|Ctrl+F5|）。
\end{itemize}

\subsection{常识}
\begin{itemize}
\item Mac 不能写入 NTFS 文件系统只能读取， 所以需要在不同系统上使用的移动硬盘最好格式化成 ExFat。
\item account name 很难修改，最好新建一个（管理员）用户，然后把老用户删掉。
\item Mac 的默认 shell 是 zsh。 要修改默认 shell （如 \verb|/bin/bash| 可以在系统的 \verb|user & groups| 设置里面把左下角解锁， 然后右键用户名， 高级设置里面修改）。 也可以用命令行修改： \verb|chsh -s /bin/bash|。
\item terminal 功能非常有限， ssh 到 linux 后甚至 \verb|home/end| 键甚至 \verb|Cmd+左右箭头| 都无效。 gpt 建议用 \verb|iTerm2|。
\item 修改 hostname 用： \verb|sudo scutil --set HostName 新名字|
\item 根目录： 选择 \verb|Go->go to folder|, 然后输入 \verb|/|, 按回车即可到根目录。 根目录里面有 Applications, Library, System, Users 四个文件夹
\item 从 U 盘启动： 长按住 \verb`Opt` 按键开机即可
\item 重新安装最新系统（联网）： 长安住 \verb|Cmd + Opt + R| 即可。 重装系统据说不会删除用户文件
\item 要抹掉磁盘， 在重新安装的界面选择 disk util， 然后擦除磁盘即可。
\item MacOS 不支持在右键新建文档，但是 AppStore 里面有一些 app 可以实现， 例如 iMouse 等， 搜 right click 即可。
\end{itemize}

\subsection{外观}
\begin{itemize}
\item 把 launchpad 变为 6 行 9 列： \verb`defaults write com.apple.dock springboard-rows -int 6; defaults write com.apple.dock springboard-columns -int 9;killall Dock`
\end{itemize}

\subsection{Finder}
\begin{itemize}
\item Finder 是苹果的文件浏览器
\item 选中文件后，回车重命名， \verb`Cmd + O` 打开文件。
\item 菜单中 \verb|View > Show Path Bar| 可以在底部显示完整路径。 \verb`Finder > Settings` 有一些常用设置。
\item 复制文件后粘贴到文本框可以粘贴绝对路径。
\item 要在当前路径打开 Terminal，鼠标右键点 finder 最下面的任何当前文件夹，点 New Terminal at Folder 即可。
\item 菜单中的 \verb`Go > Go to folder` 可以输入绝对或相对路径打开文件夹，快捷键 \verb`Cmd + Shift + G`
\end{itemize}

\subsection{Terminal}
\begin{itemize}
\item \verb`open 目录或文件` 可以打开 finder 或用默认 app 打开文件
\item 强制重启（用 GUI 重启可能会有一些软件不能正常退出） \verb|sudo shutdown -r now|
\item 要默认使用 bash 并得到类似 Linux 的体验，参考\href{https://medium.com/@geraldcroes/the-good-tweak-the-bad-mac-and-the-ugly-terminal-8f18b3c3d687}{这里}。
\item Oh My ZSH 是很流行的 zsh 插件， 可以加强自动补全等功能。 \verb`sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"`
\item 可以指定一个全局的 gitignore 文件， 如 \verb|git config --global core.excludesfile ~/.gitignore_global|，然后把恶心的 \verb`.DS_Store` 放进去。
\item 要停止在网络硬盘自动生成 \verb`.DS_Store` 文件，用 \verb`defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true`。
\item \verb`Cmd + C` 和 \verb`Cmd + V` 复制粘贴
\item 选中一段文字，按下鼠标中键可以直接粘贴。
\item Application 目录是 \verb`/Applications`， 里面每个 app 都是一个文件夹。 例如 julia 的执行文件在 \verb`sudo ln -s /Applications/Julia-1.10.app/Contents/Resources/julia/bin/julia /usr/local/bin/julia`
\end{itemize}

\subsection{一些好用的小 app}
\begin{itemize}
\item \href{https://github.com/ther0n/UnnaturalScrollWheels}{UnnaturalScrollWhells} 可以让触控板使用自然滚动，而鼠标滚轮使用 windows 式的滚动。
\end{itemize}

\subsection{AppleID}
\begin{itemize}
\item AppleID 分不同国家，有些 app 和其他服务只对部分国家开放。 如果 app 在你账号的当前国家不开放，在商店里搜索搜不到。
\item 无论是 iOS 还是 MacOS，app store 都可以使用和本机主要账号不同的 AppleID。 也就是如果你有两个 AppleID，你可以在 System Setting 里面登一个，在 AppStore 里面登另一个。
\end{itemize}

\subsection{VMware MacOS 虚拟机}
\begin{itemize}
\item 据说 VMware Workstation Pro 和 MacOS 兼容比较好。 笔者测试 MacOS 12.4 没问题。
\end{itemize}

若显示性能较差（即用小分辨率的屏幕可以明显变得顺滑）， 则修改 xm 文件的以下设置（如果没有则添加）。 但是亲测无效。
\begin{lstlisting}[language=none]
svga.vramSize = "268435456"
vmotion.checkpointFBSize = "1342177728"
vmotion.checkpointSVGAPrimarySize = "268435456"
vmotion.svga.mobMaxSize = "268435456"
vmotion.svga.graphicsMemoryKB = "262144"
svga.graphicsMemoryKB and set its value to "262144"
vmotion.svga.maxTextureSize and assign it the value "16384"
vmotion.svga.maxTextureAnisotropy, and change it to "2"
\end{lstlisting}

\subsection{Time Machine 相关}
\begin{itemize}
\item 完全没必要操作移动硬盘里面的文件! 只要进入 Time Machine 的时光界面, 用 finder 上面的小齿轮菜单, 就可以删除某次备份或者删除某个文件的所有备份 (要先选中该文件)(该操作只能在移动硬盘作为 time machine 的情况下使用)
恢复整个系统: 开机的时候按住 Cmd+R, 然后选择从 time machine 中恢复即可.
\item You can move, copy, or delete the Backups.backupdb folder on your Time Machine backup disk as you would other folders. You can also delete folders within the Backups.backupdb folder. You can’t delete individual items inside the dated folders.
\item Important: Do not use Terminal or any app other than the Finder to move, copy, or remove items from the Backups.backupdb folder.
\end{itemize}

\subsection{挂载网络硬盘}
\begin{itemize}
\item 在 Finder 菜单中， 选择 \verb`Go -> Connect to Server`，填写 \verb`smb://ip地址/分享名`
\end{itemize}

\subsection{文件服务器}
\subsubsection{SFTP}
首先可以用 sftp server, 在 Mac 上启动 server (详见 "MacOS 设置 SSH 和 FTP" 笔记)
\verb|sudo -s launchctl load -w /System/Library/LaunchDaemons/ftp.plist|， 然后在 windows 上用 WinSCP 客户端即可.

\subsubsection{SMB}
\begin{itemize}
\item 在 Mac 的 Sharing 设置中打开 SMB 共享 (最好另外创建一个 Remote 账户专门用于远程访问, 只允许在某特定的文件夹中写入, 其他只读). 然后在网络设置中的 Advanced 中设置工作组与 windows 同名 (windows 的工作组名称可以在 \verb|我的电脑->属性| 中查看, 一般叫做 WORKGROUP).

\item Mac 设置好了以后, 在网络设置中查看 IP 地址, 然后在 Windows 中随便打开一个文件浏览器, 输入 \verb|\<ip 地址>\| 看看能否访问, 如果可以就是成功了. 现在只能访问 Remote 账户的 home 文件夹, 要访问 Addis 账户的文件夹 (前提是 Addis 的文件夹权限中添加了 Remote 读取权限), 输入 \verb|\<ip 地址>\Addis| 即可! 子文件夹以此类推 (注意 windows 的目录斜线都是反斜线, 且 windows 不区分任何文件夹的大小写, 因为 command prompt 根本不区分命令的大小写). 注意 windows 搜索网络上的计算机貌似是看不到 Mac 的.

\item Mac 的 SFTP 和 SMB 都可以在 Power Nap 的时候正常工作! 设置 -> Energy Saver 仅选中 Put hard disks to sleep when possible \& Wake for network access \& Enable Power Nap 三个选项.
\end{itemize}

\subsubsection{Windows 映射网络磁盘}
浏览器中找到 \verb|这台电脑|, 右键会有 map network drive, 按照设置来, 地址就输入以上输入的即可! 在 win10 的文件浏览器主界面的 Ribbon 菜单上也会有该按钮.

创建的时候, 选择每次登录重新连接, 保存账户密码, 就真的可以像一个本地磁盘一样使用了!

\subsection{Static IP}
\begin{itemize}
\item Mac 设置 Static IP, 就不用经常改 FTP Client 的地址了, 但这种方法连一般的 wifi 时会导致连不上外网, 不要使用. 用 Dynamic DNS.
\item 首先链接网络, 点击 Wifi 图标, Open Network Preference (和在设置中进入一样). 先记下 Advanced 按钮中 TCP/IP 面板显示的几串数字 (其中 IPv4 就是常用的 IP). 为了保险先创建新的 Network Location (网络设置), 不同的 Location 互不影响, 搞砸了换回原来的即可. 在 Location 下拉菜单中创建例如 StaticIP, 然后点 Advanced, TCP/IP 中把 Configure IPv4 选成 Manually, 然后把刚才的几串数字原样输入即可. 完了以后 OK -> Apply 即可. 现在无论怎么重启, IP 都不会变了(应该).
\end{itemize}

\subsection{Dynamic DNS (Domain Name Service)}
\begin{itemize}
\item 比较有名的 Dynamic DNS 是 Dyn, 但是现在不免费了. 一个免费的叫做 NO-IP, 网址是 https://www.noip.com/, 可以在上面注册一个账号, 申请三个免费域名 (但是要每月确认才能持续有效).  域名是 "xxxx.ddns.net"  , 这串字符在远程访问时相当于 IP 地址. (貌似只能有一个域名关联一个 ip)

\item 在 Mac 上安装客户端, 这个客户端的作用就是把本地的 IP 实时和我的域名在 DNS 服务器上关联, 所以 ssh 和 sftp 输入域名时, 域名服务器就会返回正确的 IP 地址, 这与直接使用 IP 地址登录 ssh 和 sftp 是完全一样的.
注意确认 preference 中选择 "Local IP from this computer", 或者默认选项, 总之保证与域名关联的 ip 是能成功连接 ssh 或 sftp 的 ip 即可. 注意关联的 ip 以网页上的为主, 客户端显示的 internal ip 是不准确的.
另外不要设置软件开机启动, 而是在 Daemon 面板中设置开机启动 Daemon 后台, 这样开机以后 dock 栏不会显示任何图标, 但仍然可以更新 ip, 更新频率目前设置成 5 分钟一次.
每月 Confirm Hostname: 在网站的 Hostname 列表中, 会显示有效时间, 按右边的小齿轮 Modify, 在右下角有 Update Hostname 按钮.
\end{itemize}
